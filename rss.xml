<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>QsBlog</title>
    <link>https://315490.xyz/</link>
    <description>一个Qs315490私有的云备忘录</description>
    <language>zh-CN</language>
    <copyright>All rights reserved 2026, Qs315490</copyright>
    <lastBuildDate>Thu, 12 Feb 2026 13:53:37 GMT</lastBuildDate>
    <generator>Hexo</generator>
    <atom:link href="https://315490.xyz/rss.xml" rel="self" type="application/rss+xml"/>
    <item>
      <title>PVE鼠标偏移解决</title>
      <link>https://315490.xyz/2026/02/12/linux/PVE%E9%BC%A0%E6%A0%87%E5%81%8F%E7%A7%BB%E8%A7%A3%E5%86%B3/</link>
      <description>spice鼠标偏移，在虚拟机中鼠标会飘</description>
      <author>Qs315490</author>
      <category domain="https://315490.xyz/categories/linux/">linux</category>
      <category domain="https://315490.xyz/categories/linux/PVE/">PVE</category>
      <category domain="https://315490.xyz/tags/PVE/">PVE</category>
      <category domain="https://315490.xyz/tags/spice/">spice</category>
      <category domain="https://315490.xyz/tags/%E9%BC%A0%E6%A0%87%E5%81%8F%E7%A7%BB/">鼠标偏移</category>
      <pubDate>Thu, 12 Feb 2026 13:53:37 GMT</pubDate>
      <content:encoded>
        <![CDATA[<h1 id="PVE鼠标偏移解决"><a href="#PVE鼠标偏移解决" class="headerlink" title="PVE鼠标偏移解决"></a>PVE鼠标偏移解决</h1><p>spice鼠标偏移，在虚拟机中鼠标会飘，在 <code>/etc/pve/qemu-server/xxx.conf</code> 中加入：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">tablet:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>或shell中执行：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qm set xxx -tablet true</span><br></pre></td></tr></table></figure><p>然后重新启动即可。 <code>xxx</code> 是虚拟机 id</p>]]>
      </content:encoded>
    </item>
    <item>
      <title>PVE开启6-15代Intel核显虚拟化SR-IOV/GVT-g技术</title>
      <link>https://315490.xyz/2026/02/09/linux/PVE%E5%BC%80%E5%90%AF6-15%E4%BB%A3Intel%E6%A0%B8%E6%98%BE%E8%99%9A%E6%8B%9F%E5%8C%96SRIOV-GVT-g%E6%8A%80%E6%9C%AF/</link>
      <description>
        <![CDATA[<h1 id="设备支持情况"><a href="#设备支持情况" class="headerlink" title="设备支持情况"></a>设备支持情况</h1><p>英特尔持续推动英特尔®图形处理器上的图形虚拟化技术。这些技术中的最新技术是<code>单根 IO 虚拟化 （]]>
      </description>
      <author>Qs315490</author>
      <category domain="https://315490.xyz/categories/linux/">linux</category>
      <category domain="https://315490.xyz/categories/linux/PVE/">PVE</category>
      <category domain="https://315490.xyz/tags/PVE/">PVE</category>
      <category domain="https://315490.xyz/tags/SR-IOV/">SR-IOV</category>
      <category domain="https://315490.xyz/tags/GVT-g/">GVT-g</category>
      <pubDate>Mon, 09 Feb 2026 08:51:51 GMT</pubDate>
      <content:encoded>
        <![CDATA[<h1 id="设备支持情况"><a href="#设备支持情况" class="headerlink" title="设备支持情况"></a>设备支持情况</h1><p>英特尔持续推动英特尔®图形处理器上的图形虚拟化技术。这些技术中的最新技术是<code>单根 IO 虚拟化 （SR-IOV）</code>，它取代了之前的 <code>英特尔® Graphics Virtualization Technology –g （GVT-g）</code><br>要了解每个<a href="https://www.intel.cn/content/www/cn/zh/support/articles/000093216/graphics/processor-graphics.html">英特尔®显卡家族</a>支持哪种显卡虚拟化技术，请参阅下表：</p><table><thead><tr><th>产品家族</th><th>支持的显卡虚拟化技术</th></tr></thead><tbody><tr><td>英特尔® Arc™ Pro B 系列独立显卡家族（过去称为 <code>Battlemage</code>）</td><td>单根 IO 虚拟化 （SR-IOV）</td></tr><tr><td>英特尔® Arc™ B 系列独立显卡家族（过去称为 <code>Battlemage</code>）</td><td><code>不支持</code></td></tr><tr><td>英特尔® Core™ Ultra 处理器（系列 2） 处理器家族（以前称为 <code>Arrow Lake</code>）</td><td>单根 IO 虚拟化 （SR-IOV）</td></tr><tr><td>英特尔® Core™ Ultra 处理器（系列 2） 处理器家族（以前称为 <code>Lunar Lake</code>）</td><td><code>不支持</code></td></tr><tr><td>英特尔® Core™ Ultra 处理器（系列 1） 处理器家族（以前称为 <code>Meteor Lake</code>）</td><td><code>不支持</code></td></tr><tr><td>第 14 代英特尔® 酷睿™处理器家族（过去称为 <code>Raptor Lake Refresh</code>）</td><td>单根 IO 虚拟化 （SR-IOV）</td></tr><tr><td>第 13 代英特尔® 酷睿™处理器家族（过去称为 <code>Raptor Lake</code>）</td><td>单根 IO 虚拟化 （SR-IOV）</td></tr><tr><td>英特尔® Data Center GPU Flex Series 独立显卡家族（过去称为 <code>Arctic Sound</code>）</td><td>单根 IO 虚拟化 （SR-IOV）</td></tr><tr><td>英特尔® Arc™ Pro A 系列独立显卡家族（过去称为 <code>Alchemist</code>）</td><td><code>不支持</code></td></tr><tr><td>英特尔® Arc™ A 系列独立显卡家族（过去称为 <code>Alchemist</code>）</td><td><code>不支持</code></td></tr><tr><td>第 12 代智能英特尔® 酷睿™处理器家族（过去称为 <code>Alder Lake</code>）</td><td>单根 IO 虚拟化 （SR-IOV）</td></tr><tr><td>第十一代智能英特尔® 酷睿™处理器家族（前身为 <code>Tiger Lake</code>）</td><td><code>不支持</code></td></tr><tr><td>第十一代智能英特尔® 酷睿™处理器家族（过去称为 <code>Rocket Lake</code>）</td><td>英特尔® Graphics Virtualization Technology –g （GVT-g）</td></tr><tr><td>第十代智能英特尔® 酷睿™处理器家族（过去称为 <code>Ice Lake</code>）</td><td>英特尔® Graphics Virtualization Technology –g （GVT-g）</td></tr><tr><td>第十代智能英特尔® 酷睿™处理器家族（过去称为 <code>Comet Lake</code></td><td>英特尔® Graphics Virtualization Technology –g （GVT-g）</td></tr><tr><td>第九代智能英特尔® 酷睿™处理器家族（以前称为 <code>Coffee Lake Refresh</code>）</td><td>英特尔® Graphics Virtualization Technology –g （GVT-g）</td></tr><tr><td>第八代智能英特尔® 酷睿™处理器家族（过去称为 <code>Amber Lake</code>）</td><td>英特尔® Graphics Virtualization Technology –g （GVT-g）</td></tr><tr><td>第八代智能英特尔® 酷睿™处理器家族（过去称为 <code>Coffee Lake</code>）</td><td>英特尔® Graphics Virtualization Technology –g （GVT-g）</td></tr><tr><td>第七代智能英特尔® 酷睿™处理器家族（前身为 <code>Apollo Lake</code>）</td><td>英特尔® Graphics Virtualization Technology –g （GVT-g）</td></tr><tr><td>第七代智能英特尔® 酷睿™处理器家族（过去称为 <code>Kaby Lake</code>）</td><td>英特尔® Graphics Virtualization Technology –g （GVT-g）</td></tr><tr><td>第六代智能英特尔® 酷睿™处理器家族（前身为 <code>Skylake</code>）</td><td>英特尔® Graphics Virtualization Technology –g （GVT-g）</td></tr></tbody></table><p>注意，代号为 <code>Battlemage</code> | <code>Lunar Lake</code> | <code>Meteor Lake</code> | <code>Alchemist</code> | <code>Tiger Lake</code> 这5款图形处理器并不支持<code>SR-IOV</code>，也不支持<code>GVT-g</code></p><h1 id="PVE基本设置"><a href="#PVE基本设置" class="headerlink" title="PVE基本设置"></a>PVE基本设置</h1><p>安装PVE过程略过，提前将pve安装好，如要正常使用<code>11-15代</code>核显<code>SR-IOV</code>，需要将<code>内核更新到6.8及以上</code>。并在BIOS提前开启<code>VT-d</code>（必须）,<code>SR-IOV</code>(如有可以开), <code>Above 4GB</code>(如有可以开),和关闭安全模式(<code>Secure Boot</code>)</p><p>本篇文章将大量使用nano文本编辑命令，至于怎么使用自行百度，这里不重复造轮子了。 知道如何保存就行Ctrl +X 输入“Y”回车保存</p><h1 id="开启GPU虚拟化"><a href="#开启GPU虚拟化" class="headerlink" title="开启GPU虚拟化"></a>开启GPU虚拟化</h1><div class="tabs" id="tab-gpu-virt"><ul class="nav-tabs"><li class="tab active"><a class="#gpu-virt-1">SR-IOV</a></li><li class="tab"><a class="#gpu-virt-2">GVT-g</a></li></ul><div class="tab-content"><div class="tab-pane active" id="gpu-virt-1"><h2 id="intel-11-15代开启SRIOV核显虚拟化"><a href="#intel-11-15代开启SRIOV核显虚拟化" class="headerlink" title="intel 11-15代开启SRIOV核显虚拟化"></a>intel 11-15代开启SRIOV核显虚拟化</h2><h3 id="安装headers头文件"><a href="#安装headers头文件" class="headerlink" title="安装headers头文件"></a>安装headers头文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install pve-headers-$(<span class="built_in">uname</span> -r)</span><br></pre></td></tr></table></figure><h3 id="安装构建工具"><a href="#安装构建工具" class="headerlink" title="安装构建工具"></a>安装构建工具</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install build-essential dkms</span><br></pre></td></tr></table></figure><h3 id="下载i915-sriov驱动"><a href="#下载i915-sriov驱动" class="headerlink" title="下载i915-sriov驱动"></a>下载i915-sriov驱动</h3><p>国内访问github很慢，建议给PVE挂上代理再下载，或者手动到github下载下来再上传到PVE<br><a href="https://github.com/strongtz/i915-sriov-dkms/releases">i915-sriov版本发布页</a><br>适用于<code>6.8 ~ 6.16</code>内核的i915-sriov驱动，下载到临时目录&#x2F;tmp&#x2F;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -O /tmp/i915-sriov-dkms_2025.07.22_amd64.deb <span class="string">&quot;http://dl.yangwenqing.com/webos/link/8f592d04d4be4194a8fe5a2fff6446f6/i915-sriov-dkms_2025.07.22_amd64.deb&quot;</span></span><br></pre></td></tr></table></figure><p>适用于<code>6.12 ~ 6.19</code>内核的i915-sriov驱动，下载到临时目录&#x2F;tmp&#x2F;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -O /tmp/i915-sriov-dkms_2026.02.04_amd64.deb <span class="string">&quot;http://dl.yangwenqing.com/webos/link/4a03e8873eea4aaeaa1532927134b830/i915-sriov-dkms_2026.02.04_amd64.deb&quot;</span></span><br></pre></td></tr></table></figure><h3 id="安装SR-IOV驱动"><a href="#安装SR-IOV驱动" class="headerlink" title="安装SR-IOV驱动"></a>安装SR-IOV驱动</h3><p>如果你的PVE内核是<code>Linux6.8 ~ 6.16</code>的版本则安装<code>i915-sriov-dkms_2025.07.22_amd64.deb</code><br>如果你的PVE内核是<code>Linux6.12 ~ 6.19</code>的版本则安装<code>i915-sriov-dkms_2026.02.04_amd64.deb</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg -i /tmp/i915-sriov-dkms*.deb</span><br></pre></td></tr></table></figure><p>经过漫长等待完成后，检查安装是否成功，运行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">modinfo i915|grep vf</span><br></pre></td></tr></table></figure><p>反馈如下表示成功：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">parm:           max_vfs:Limit number of virtual functions to allocate. (0 = no VFs [default]; N = allow up to N VFs) (uint)</span><br></pre></td></tr></table></figure><h4 id="如何安装6-8内核？"><a href="#如何安装6-8内核？" class="headerlink" title="如何安装6.8内核？"></a>如何安装6.8内核？</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装6.8.12-10-pve内核</span></span><br><span class="line">apt install pve-kernel-6.8.12-10-pve</span><br><span class="line"><span class="comment"># 查看当前安装的内核</span></span><br><span class="line">proxmox-boot-tool kernel list</span><br><span class="line"><span class="comment"># 如 6.8.12-10-pve</span></span><br><span class="line"><span class="comment"># 将装好的6.8内核设置成第一启动项，重启PVE即可进到新内核</span></span><br><span class="line">proxmox-boot-tool kernel pin 6.8.12-10-pve</span><br><span class="line"><span class="comment"># 别忘了更新内核后给内核安装头文件再打驱动</span></span><br><span class="line">apt install pve-headers-$(<span class="built_in">uname</span> -r)</span><br></pre></td></tr></table></figure><h3 id="设置内核参数"><a href="#设置内核参数" class="headerlink" title="设置内核参数"></a>设置内核参数</h3><p>需要提前在主板BIOS开启虚拟化功能，才能开启硬件直通。在BIOS开启<code>vt-d</code>, <code>SR-IOV</code>(如有可以开), <code>Above 4GB</code>(如有可以开), 和关闭安全模式(<code>Secure Boot</code>)。<br>使用nano命令编辑<code>/etc/default/grub</code>文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano /etc/default/grub</span><br></pre></td></tr></table></figure><p>开启<code>iommu</code>分组、<code>i915 guc</code>和<code>SR-IOV</code>，在里面找到：GRUB_CMDLINE_LINUX_DEFAULT&#x3D;”quiet”项将其修改为</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet intel_iommu=on iommu=pt i915.enable_guc=3 i915.max_vfs=7 module_blacklist=xe&quot;</span><br></pre></td></tr></table></figure><p>修改完成更新grub</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update-grub</span><br></pre></td></tr></table></figure><p>然后重启PVE</p><h3 id="设置SR-IOV显卡数量"><a href="#设置SR-IOV显卡数量" class="headerlink" title="设置SR-IOV显卡数量"></a>设置SR-IOV显卡数量</h3><p>按需设置最高7个（<code>i915.max_vfs=7</code>），设置1个时性能最强。</p><h4 id="安装sysfsutils"><a href="#安装sysfsutils" class="headerlink" title="安装sysfsutils"></a>安装sysfsutils</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install -y sysfsutils</span><br></pre></td></tr></table></figure><h4 id="添加VFs核显数量"><a href="#添加VFs核显数量" class="headerlink" title="添加VFs核显数量"></a>添加VFs核显数量</h4><p>按需设置最高7个，设置1个时性能最强。<br>开启3个VFs核显数量:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 3 &gt; /sys/devices/pci0000:00/0000:00:02.0/sriov_numvfs</span><br></pre></td></tr></table></figure><p>或者持久化到<code>/etc/sysfs.conf</code>文件中，重启后依然生效</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;devices/pci0000:00/0000:00:02.0/sriov_numvfs = 3&quot;</span> &gt; /etc/sysfs.conf</span><br><span class="line"><span class="comment"># 应用配置文件, 重启也行</span></span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure><h3 id="验证是否开启核显SRIOV"><a href="#验证是否开启核显SRIOV" class="headerlink" title="验证是否开启核显SRIOV"></a>验证是否开启核显SRIOV</h3><p>使用lspci命令查看核显信息，有如下内容则成功开启核显<br>注意：物理核显02.0不能直通，否则所有虚拟核显消失</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">00:02.0 VGA compatible controller: Intel Corporation Alder Lake-S GT1 [UHD Graphics 770]（物理核显）</span><br><span class="line">00:02.1 VGA compatible controller: Intel Corporation Alder Lake-S GT1 [UHD Graphics 770] （虚拟核显1）</span><br><span class="line">00:02.2 VGA compatible controller: Intel Corporation Alder Lake-S GT1 [UHD Graphics 770] （虚拟核显2）</span><br><span class="line">00:02.3 VGA compatible controller: Intel Corporation Alder Lake-S GT1 [UHD Graphics 770] （虚拟核显3）</span><br></pre></td></tr></table></figure><h3 id="温馨提示"><a href="#温馨提示" class="headerlink" title="温馨提示"></a>温馨提示</h3><p>如果你的处理器是最新的<code>Arrow Lake</code>架构，安装了<code>i915-sriov-dkms</code>，没法看到7个VF。可以另外加上<code>i915.force_probe=7d67</code>参数到grub。</p></div><div class="tab-pane" id="gpu-virt-2"><h2 id="开启硬件直通和GVT-g"><a href="#开启硬件直通和GVT-g" class="headerlink" title="开启硬件直通和GVT-g"></a>开启硬件直通和GVT-g</h2><h3 id="设置内核参数"><a href="#设置内核参数" class="headerlink" title="设置内核参数"></a>设置内核参数</h3><p>需要提前在主板BIOS开启虚拟化功能，才能开启硬件直通。在BIOS开启<code>vt-d</code>, <code>Above 4GB</code>(如有可以开)和关闭安全模式(<code>Secure Boot</code>)。<br>使用nano命令编辑&#x2F;etc&#x2F;default&#x2F;grub</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano /etc/default/grub </span><br></pre></td></tr></table></figure><p>开启iommu分组和GVT-g，在里面找到：GRUB_CMDLINE_LINUX_DEFAULT&#x3D;”quiet”项将其修改为</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet intel_iommu=on iommu=pt i915.enable_gvt=1 pcie_acs_override=downstream,multifunction&quot;</span><br></pre></td></tr></table></figure><p>更新grub</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update-grub</span><br></pre></td></tr></table></figure><p>重启PVE</p><h3 id="验证是否开启GVT-g"><a href="#验证是否开启GVT-g" class="headerlink" title="验证是否开启GVT-g"></a>验证是否开启GVT-g</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> /sys/bus/pci/devices/0000:00:02.0/mdev_supported_types</span><br></pre></td></tr></table></figure><p>显示有2个或者更多即成功，UHD630核显最多可以开2个</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">i915-GVTg_V5_4  i915-GVTg_V5_8</span><br></pre></td></tr></table></figure></div></div></div><h1 id="验证是否开启-iommu"><a href="#验证是否开启-iommu" class="headerlink" title="验证是否开启 iommu"></a>验证是否开启 iommu</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dmesg | grep iommu</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">dmesg | grep -e DMAR -e IOMMU -e AMD-Vi</span><br></pre></td></tr></table></figure><p>出现如下例子。则代表成功</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[ 1.341100] pci 0000:00:00.0: Adding to iommu group 0</span><br><span class="line">[ 1.341116] pci 0000:00:01.0: Adding to iommu group 1</span><br><span class="line">[ 1.341126] pci 0000:00:02.0: Adding to iommu group 2</span><br><span class="line">[ 1.341137] pci 0000:00:14.0: Adding to iommu group 3</span><br><span class="line">[ 1.341146] pci 0000:00:17.0: Adding to iommu group 4</span><br></pre></td></tr></table></figure><p>此时输入命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /sys/kernel/iommu_groups/ -<span class="built_in">type</span> l</span><br></pre></td></tr></table></figure><p>出现很多直通组，就代表成功了。如果没有任何东西，就是没有开启</p><h1 id="虚拟机设置"><a href="#虚拟机设置" class="headerlink" title="虚拟机设置"></a>虚拟机设置</h1><p>推荐OVMF启动方式，其他部分和普通PCIe直通一样，设置好虚拟机即可。</p><div class="tabs" id="tab-gpu-virt"><ul class="nav-tabs"><li class="tab active"><a class="#gpu-virt-1">SR-IOV</a></li><li class="tab"><a class="#gpu-virt-2">GVT-g</a></li></ul><div class="tab-content"><div class="tab-pane active" id="gpu-virt-1"><p class='p red'>注意: 不要把物理核显02.0直通，否则所有虚拟核显消失</p></div><div class="tab-pane" id="gpu-virt-2"><p>添加PCI设备时勾选<code>ROM-Bar</code>和<code>PCIE</code>在<code>Mdev类型</code>中选择vgpu设备<code>i915-GVTg_V5_8</code>或其他配置项</p></div></div></div>]]>
      </content:encoded>
    </item>
    <item>
      <title>PVE系统无有效订阅提示弹窗</title>
      <link>https://315490.xyz/2026/02/09/linux/PVE%E7%B3%BB%E7%BB%9F%E6%97%A0%E6%9C%89%E6%95%88%E8%AE%A2%E9%98%85%E6%8F%90%E7%A4%BA%E5%BC%B9%E7%AA%97/</link>
      <description>Proxmox VE (PVE) 是一款优秀的开源虚拟化管理平台，基于 Debian 并集成了 KVM 和 LXC 虚拟化技术。然而，在使用社区版时，每次登录 Web 管理界面都会弹出订阅提示窗口，虽然不影响功能使用，但频繁出现确实会影响使用体验。</description>
      <author>Qs315490</author>
      <category domain="https://315490.xyz/categories/linux/">linux</category>
      <category domain="https://315490.xyz/categories/linux/PVE/">PVE</category>
      <category domain="https://315490.xyz/tags/KVM/">KVM</category>
      <category domain="https://315490.xyz/tags/PVE/">PVE</category>
      <pubDate>Mon, 09 Feb 2026 08:36:31 GMT</pubDate>
      <content:encoded>
        <![CDATA[<h1 id="8-x"><a href="#8-x" class="headerlink" title="8.x"></a>8.x</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> /usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js /usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js.bak</span><br><span class="line"></span><br><span class="line">sed -i <span class="string">&quot;s/if (res === null || res === undefined || \!res || res/if(/g&quot;</span> /usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js</span><br><span class="line">sed -i <span class="string">&quot;s/.data.status.toLowerCase() !== &#x27;active&#x27;/false/g&quot;</span> /usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js</span><br><span class="line"></span><br><span class="line">systemctl restart pveproxy</span><br></pre></td></tr></table></figure><h1 id="9-x"><a href="#9-x" class="headerlink" title="9.x"></a>9.x</h1><p>PVE 9.x的版本，除了每次登录WEB后台会显示无有效订阅提示弹窗之外，在点击「软件包版本」按钮时，首先也会弹出「无有效订阅」的提示弹窗，然后再跳转到软件包版本页面。<br>以前版本没有这种逻辑。推测应该是这个原因导致旧方法不能完美适配PVE 9.x版本。</p><p>新方法的核心原理是替换关系表达式符号，其本质仅仅是替换一个字符而已，即将!&#x3D;&#x3D;替换为&#x3D;&#x3D;&#x3D;，不同于旧方法原理的修改替换关系表达式条件。<br>新方法完美适配PVE 9.x版本，不会导致PVE的WEB后台「软件包版本」按钮无法响应。<br>新方法的命令操作步骤：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> /usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js /usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js.bak</span><br><span class="line"></span><br><span class="line">line_num=$(grep -n <span class="string">&quot;res.data.status.toLowerCase() !== &#x27;active&#x27;&quot;</span> /usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js | <span class="built_in">head</span> -1 | <span class="built_in">cut</span> -d: -f1)</span><br><span class="line">sed -i <span class="string">&quot;<span class="variable">$&#123;line_num&#125;</span>s/!==/===/&quot;</span> /usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js</span><br><span class="line"></span><br><span class="line">systemctl restart pveproxy</span><br></pre></td></tr></table></figure><p>这个新方法同样适用于屏蔽PBS备份系统的无有效订阅提示弹窗，即Proxmox Backup Server，修改文件操作完成之后重启PBS代理服务即可。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart proxmox-backup-proxy</span><br></pre></td></tr></table></figure>]]>
      </content:encoded>
    </item>
    <item>
      <title>KVM问题解决</title>
      <link>https://315490.xyz/2026/02/09/linux/KVM%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/</link>
      <description>KVM 常见问题解决，以及一些小技巧</description>
      <author>Qs315490</author>
      <category domain="https://315490.xyz/categories/linux/">linux</category>
      <category domain="https://315490.xyz/categories/linux/KVM/">KVM</category>
      <category domain="https://315490.xyz/tags/KVM/">KVM</category>
      <category domain="https://315490.xyz/tags/Linux/">Linux</category>
      <category domain="https://315490.xyz/tags/AMD-GPU/">AMD GPU</category>
      <pubDate>Mon, 09 Feb 2026 08:30:29 GMT</pubDate>
      <content:encoded>
        <![CDATA[<h1 id="AMD-GPU-Reset-BUG"><a href="#AMD-GPU-Reset-BUG" class="headerlink" title="AMD GPU Reset BUG"></a>AMD GPU Reset BUG</h1><p>内核参数添加 <code>amdgpu.reset_method=0</code></p>]]>
      </content:encoded>
    </item>
    <item>
      <title>Ubuntu Locale总是包含其他配置</title>
      <link>https://315490.xyz/2025/10/31/linux/Ubuntu-Locale%E6%80%BB%E6%98%AF%E5%8C%85%E5%90%AB%E5%85%B6%E4%BB%96%E9%85%8D%E7%BD%AE/</link>
      <description>
        <![CDATA[<h1 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h1><p>locale-gen 生成的locale总是包含其他配置，例如：</p>
<figure class="highlight]]>
      </description>
      <author>Qs315490</author>
      <category domain="https://315490.xyz/categories/linux/">linux</category>
      <category domain="https://315490.xyz/categories/linux/locale/">locale</category>
      <category domain="https://315490.xyz/tags/linux/">linux</category>
      <category domain="https://315490.xyz/tags/ubuntu/">ubuntu</category>
      <category domain="https://315490.xyz/tags/locale/">locale</category>
      <pubDate>Fri, 31 Oct 2025 10:40:44 GMT</pubDate>
      <content:encoded>
        <![CDATA[<h1 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h1><p>locale-gen 生成的locale总是包含其他配置，例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">zh_CN.UTF-8</span><br><span class="line">en_US.UTF-8</span><br><span class="line">en_GB.UTF-8</span><br></pre></td></tr></table></figure><p>但是locale.conf中只配置了其中一个:<code>zh_CN.UTF-8</code></p><h1 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h1><p>Ubuntu默认会安装 <code>language-pack-en</code>, 这些语言包会让locale-gen生成对应的locale<br>对应 <code>/var/lib/locales/supported.d/en</code> 文件，这里面就是没配置但会生成的locale</p><h1 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h1><p>卸载 <code>language-pack-en</code>，然后重新生成locale<br>或者直接编辑 <code>/var/lib/locales/supported.d/en</code> 文件，删除不需要的locale</p>]]>
      </content:encoded>
    </item>
    <item>
      <title>SysRq</title>
      <link>https://315490.xyz/2025/10/30/linux/SysRq/</link>
      <description>
        <![CDATA[<h1 id="proc-sysrq-trigger详解"><a href="#proc-sysrq-trigger详解" class="headerlink" title="&#x2F;proc&#x2F;sysrq-trigger详解"></a>&#x2F;proc&#x2F]]>
      </description>
      <author>Qs315490</author>
      <category domain="https://315490.xyz/categories/linux/">linux</category>
      <category domain="https://315490.xyz/categories/linux/sqsrq/">sqsrq</category>
      <category domain="https://315490.xyz/tags/linux/">linux</category>
      <category domain="https://315490.xyz/tags/sysrq/">sysrq</category>
      <pubDate>Thu, 30 Oct 2025 09:48:46 GMT</pubDate>
      <content:encoded>
        <![CDATA[<h1 id="proc-sysrq-trigger详解"><a href="#proc-sysrq-trigger详解" class="headerlink" title="&#x2F;proc&#x2F;sysrq-trigger详解"></a>&#x2F;proc&#x2F;sysrq-trigger详解</h1><p>这是一组“魔术组合键”，只要内核没有被完全锁住，不管内核在做什么事情，使用这些组合键能即时打印出内核的信息。</p><p>使用SysRq组合键是了解系统目前运行情况的最佳方式。如果系统出现挂起的情况或在诊断一些和内核相关，比较怪异，比较难重现的问题的时候，使用SysRq键是个比较好的方式。</p><h1 id="怎么打开和关闭SysRq组合键"><a href="#怎么打开和关闭SysRq组合键" class="headerlink" title="怎么打开和关闭SysRq组合键?"></a>怎么打开和关闭SysRq组合键?</h1><p>为了安全起见，在红帽企业版Linux里面，默认SysRq组合键是关闭的。 打开这个功能，运行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/kernel/sysrq</span><br></pre></td></tr></table></figure><p>关闭这个功能：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 0 &gt; /proc/sys/kernel/sysrq</span><br></pre></td></tr></table></figure><p>如果想让此功能一直生效，在&#x2F;etc&#x2F;sysctl.conf里面设置kernel.sysrq的值为1。重新启动以后，此功能将会自动打开。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;kernel.sysrq = 1&#x27;</span> &gt; /etc/sysctl.conf</span><br></pre></td></tr></table></figure><p>因为打开sysrq键的功能以后，有终端访问权限的用户将会拥有一些特别的功能。因此，除非是要调试，解决问题，一般情况下，不要打开此功能。如果一定要打开，请确保你的终端访问的安全性。</p><h1 id="怎么触发一个sysrq事件"><a href="#怎么触发一个sysrq事件" class="headerlink" title="怎么触发一个sysrq事件?"></a>怎么触发一个sysrq事件?</h1><p>有几种方式能触发sysrq事件。在带有AT键盘的一般系统上，在终端上输入一下组合键:</p><kbd>Alt</kbd>+<kbd>PrintScreen</kbd>+[CommandKey]<p>例如，要让内核导出内存信息(CommandKey “m”)，你应该同时按下<kbd>Alt</kbd> 和 <kbd>Print Screen</kbd> 键，然后按下 <kbd>M</kbd> 键。</p><p>提示：此组合键在Xwindows上是无法使用的。所以，你先要转换到文本虚拟终端下。如果你当前是在图像界面，</p><p>能按<kbd>Ctrl</kbd>+<kbd>Alt</kbd>+<kbd>F1</kbd>转换到虚拟终端。</p><p>在串口终端上,要想获得同样的效果，需要先在终端上发送Break信号，然后在5秒内输入sysrq组合键。</p><p>如果你在机器上有root权限，你能把commandkey字符写入到&#x2F;proc&#x2F;sysrq-trigger文件。这能帮助你通过脚本或你不在系统终端上的时候触发sysrq事件。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> m &gt; /proc/sysrq-trigger</span><br></pre></td></tr></table></figure><p>当我触发一个sysrq事件的时候，结果保存在什么地方?</p><p>当一个sysrq命令被触发，内核将会打印信息到内核的环形缓冲并输出到系统控制台。此信息一般也会通过syslog输出到&#x2F;var&#x2F;log&#x2F;messages。</p><p>有时候，可能系统已无法响应，syslogd可能无法记录此信息。在这种情况下，建议你设置一个串口终端来收集这个信息。</p><p>那些类型的sysrq事件能被触发?</p><p>sysrq功能被打开后，有几种sysrq事件能被触发。不同的内核版本可能会有些不同。但有一些是共用的：</p><table><thead><tr><th>CommandKey</th><th>功能</th></tr></thead><tbody><tr><td>b</td><td>立即重新启动计算机</td></tr><tr><td>o</td><td>立即关闭计算机(如果机器设置并支持此项功能)</td></tr><tr><td>m</td><td>导出关于内存分配的信息</td></tr><tr><td>t</td><td>导出线程状态信息</td></tr><tr><td>p</td><td>导出当前CPU寄存器信息和标志位的信息</td></tr><tr><td>c</td><td>故意让系统崩溃(在使用netdump或diskdump的时候有用)</td></tr><tr><td>s</td><td>即时同步所有挂载的文件系统</td></tr><tr><td>u</td><td>立即重新挂载所有的文件系统为只读</td></tr></tbody></table>]]>
      </content:encoded>
    </item>
    <item>
      <title>Android 手动触发 dex2oat</title>
      <link>https://315490.xyz/2025/10/15/android/android-dex2oat/</link>
      <description>
        <![CDATA[<h1 id="介绍-dex2oat"><a href="#介绍-dex2oat" class="headerlink" title="介绍 dex2oat"></a>介绍 dex2oat</h1><p>运用 dex2oat 提前把dex编译成oat文件，提高应用运行效率。</p]]>
      </description>
      <author>Qs315490</author>
      <category domain="https://315490.xyz/categories/Android/">Android</category>
      <category domain="https://315490.xyz/categories/Android/%E4%BC%98%E5%8C%96/">优化</category>
      <category domain="https://315490.xyz/tags/Android/">Android</category>
      <category domain="https://315490.xyz/tags/%E4%BC%98%E5%8C%96/">优化</category>
      <category domain="https://315490.xyz/tags/dex2oat/">dex2oat</category>
      <pubDate>Wed, 15 Oct 2025 14:27:29 GMT</pubDate>
      <content:encoded>
        <![CDATA[<h1 id="介绍-dex2oat"><a href="#介绍-dex2oat" class="headerlink" title="介绍 dex2oat"></a>介绍 dex2oat</h1><p>运用 dex2oat 提前把dex编译成oat文件，提高应用运行效率。</p><h2 id="AOT-JIT"><a href="#AOT-JIT" class="headerlink" title="AOT &amp; JIT"></a>AOT &amp; JIT</h2><p>Android 从 L(5.0) 开始，引入了 ART 虚拟机，拥有了预先 (AOT) 编译的新特性，即在安装时ART就通过 dex2oat 工具来编译应用，提高应用运行时的效率。但是，安装过程执行dex2oat会增加安装应用的时间。</p><p>于是Android N(7.0)引入了新的机制，运行时 (ART) 包含一个具备代码分析功能的即时 (JIT) 编译器，有助于提高运行时性能，节省存储空间，以及加快应用及系统更新速度。JIT在软件安装时不进行编译而是根据用户的使用习惯来记录值得编译的内容 (包括软件运行时编译并保存，在闲时编译记录的需要编译而没来得及干的事情，而这些事情就是记录为speed-profile)。</p><h2 id="编译模式"><a href="#编译模式" class="headerlink" title="编译模式"></a>编译模式</h2><p>从Android O(8.0)开始，官方支持4个编译模式。</p><ul><li>verify：只运行 DEX 代码验证。</li><li>quicken：<code>Android 11 或更低版本</code> 运行 DEX 代码验证，并优化一些 DEX 指令，以获得更好的解译器性能。</li><li>speed：运行 DEX 代码验证，并对所有方法进行 AOT 编译。不优化任何类的类加载。</li><li>speed-profile：运行 DEX 代码验证，对配置文件中列出的方法进行 AOT 编译，并为配置文件中的类优化类加载。</li></ul><p><code>Android 14 及更高版本</code> 默认使用 speed-profile 编译过滤器进行编译；如果未提供配置文件，则使用 speed 编译过滤器进行编译。<br><code>Android 13 及更低版本</code> 默认使用 speed 编译过滤器进行编译。</p><p>以下是 Android 文档中并未明确提及的编译模式：</p><ul><li>space-profile: 依据配置文件优化空间使用</li><li>space: 优化空间使用</li><li>everything: 编译所有方法，也是占用手机容量空间最大的模式</li></ul><h2 id="操作限制"><a href="#操作限制" class="headerlink" title="操作限制"></a>操作限制</h2><p>而随着Android系统版本的更迭，发现原本可以在应用进程上触发dex2oat编译的方式，却在<code>targetSdkVersion&gt;=29且Android 10+</code>的系统上，不再允许使用。其原因是系统在<code>targetSdkVersion=29</code>的时候，对此做了限制，不允许应用进程上触发dex2oat编译（Android 运行时 (ART) 不再从应用进程调用 dex2oat。这项变更意味着 ART 将仅接受系统生成的 OAT 文件）（OAT为dex2oat后的产物）。</p><p>那当前是否会受到这个限制的影响呢？</p><p>在2020年的时候Android 11系统正式发布，各大应用市场就开始限制App的<code>targetSdkVersion&gt;=29</code>，也就意味着，现如今App的<code>targetSdkVersion&gt;=29</code>是不可避免的。而且随着新Android设备的不断迭代，越来越多的用户，使用上了携带新系统的新机器，使得Android 10+系统的占有量逐步增加，目前为止Android 10+系统的占有量约占整体的30%~40%左右，也就是说这部分机器将会受到这个限制的影响。</p><p><code>cmd package compile</code>是应用进程触发系统行为，然后由系统触发dex2oat的方式。不受<code>targetSdkVersion&gt;=29</code>的限制，但是需要root权限，且需要系统版本为Android 10+。</p><h1 id="手动触发-dex2oat"><a href="#手动触发-dex2oat" class="headerlink" title="手动触发 dex2oat"></a>手动触发 dex2oat</h1><p>强制编译可通过如下命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd package compile -m &lt;compile-mode&gt; -f &lt;package-name&gt;</span><br></pre></td></tr></table></figure><p>其中，<code>&lt;compile-mode&gt;</code> 可以是 <code>verify</code>、<code>quicken</code>、<code>speed</code>、<code>speed-profile</code> 之一，<code>&lt;package-name&gt;</code> 是要编译的包名。</p><p>编译所有应用</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd package compile -m &lt;compile-mode&gt; -f -a</span><br></pre></td></tr></table></figure><h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p>speed-profile 某个应用</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd package compile -m speed-profile -f com.example.app</span><br></pre></td></tr></table></figure><p>speed-profile 所有应用</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd package compile -m speed-profile -f -a</span><br></pre></td></tr></table></figure><p>日常在手机上手动执行dex2oat只需要</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd package compile -m speed -a</span><br></pre></td></tr></table></figure><h1 id="清除配置文件数据并移除编译后的代码"><a href="#清除配置文件数据并移除编译后的代码" class="headerlink" title="清除配置文件数据并移除编译后的代码"></a>清除配置文件数据并移除编译后的代码</h1><p>对特定软件包</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd package compile --reset &lt;package-name&gt;</span><br></pre></td></tr></table></figure><p>对所有软件包</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd package compile --reset -a</span><br></pre></td></tr></table></figure><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://source.android.com/docs/core/runtime/configure?hl=zh-cn">Android官方文档</a></li></ul>]]>
      </content:encoded>
    </item>
    <item>
      <title>Windows11 升级24H2之后无法关闭Hyper-V怎么办？</title>
      <link>https://315490.xyz/2025/10/15/windows/Windows11_24H2%E5%90%8EHyper-V%E5%85%B3%E4%B8%8D%E4%BA%86/</link>
      <description>
        <![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>在升级Windows 11至24H2版本后，因Microsoft为所有全新安装和升级的 Windows 11 默认开启了 Device&#x]]>
      </description>
      <author>Qs315490</author>
      <category domain="https://315490.xyz/categories/Windows/">Windows</category>
      <category domain="https://315490.xyz/categories/Windows/%E8%99%9A%E6%8B%9F%E5%8C%96/">虚拟化</category>
      <category domain="https://315490.xyz/tags/Windows/">Windows</category>
      <category domain="https://315490.xyz/tags/%E8%99%9A%E6%8B%9F%E5%8C%96/">虚拟化</category>
      <category domain="https://315490.xyz/tags/%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B3%E5%8F%B0/">虚拟机平台</category>
      <category domain="https://315490.xyz/tags/HyperV/">HyperV</category>
      <pubDate>Wed, 15 Oct 2025 13:48:57 GMT</pubDate>
      <content:encoded>
        <![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>在升级Windows 11至24H2版本后，因Microsoft为所有全新安装和升级的 Windows 11 默认开启了 Device&#x2F;Credential Guard功能，且该功能会调用Hyper-V功能（即基于虚拟化的安全性功能），导致部分用户会遇到无法关闭Hyper-V的情况，导致使用虚拟机过程中感觉运行卡顿、虚拟机无法启动等情况，可参考以下步骤操作关闭Hyper-V功能。</p><h1 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h1><h2 id="1-下载工具"><a href="#1-下载工具" class="headerlink" title="1. 下载工具"></a>1. 下载工具</h2><p>从 Microsoft 下载中心下载<a href="https://www.microsoft.com/en-us/download/details.aspx?id=53337">Device Guard and Credential Guard hardware readiness tool</a><br><img src="/images/windows_hyperv/%E4%B8%8B%E8%BD%BDDGCG.webp" class="lazyload" data-srcset="/images/windows_hyperv/%E4%B8%8B%E8%BD%BDDGCG.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="下载DGCG"></p><h2 id="2-解压工具"><a href="#2-解压工具" class="headerlink" title="2. 解压工具"></a>2. 解压工具</h2><p>解压下载的文件，并进入解压后的文件夹。点击文件夹上方的地址栏，复制地址内容。<br><img src="/images/windows_hyperv/%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84.webp" class="lazyload" data-srcset="/images/windows_hyperv/%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="文件路径"></p><h2 id="3-终端目录切换"><a href="#3-终端目录切换" class="headerlink" title="3. 终端目录切换"></a>3. 终端目录切换</h2><p>鼠标右键点击Windows菜单<br>Windows 11选择终端管理员，Windows 10选择 Windows PowerShell(管理员)<br>并确保终端运行的Shell为PowerShell<br><img src="/images/windows_hyperv/Windows%E7%BB%88%E7%AB%AF.webp" class="lazyload" data-srcset="/images/windows_hyperv/Windows%E7%BB%88%E7%AB%AF.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Windows终端"></p><p>在终端输入<code>cd &lt;目录路径&gt;</code>即可切换目录，例如：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> C:\Temp\dgreadiness_tool_v3.<span class="number">6</span></span><br></pre></td></tr></table></figure><p>在终端或 PowerShell中输入cd，按下空格后 粘贴（右键或<kbd>Ctrl</kbd>+<kbd>V</kbd>）剪切板的路径，并按下回车，切换到对应文件夹目录路径。</p><h2 id="4-运行脚本"><a href="#4-运行脚本" class="headerlink" title="4. 运行脚本"></a>4. 运行脚本</h2><p>先设置执行策略为RemoteSigned，否则会报错。<br>复制并粘贴以下命令到终端，然后按下<kbd>Enter</kbd>键执行。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set-ExecutionPolicy</span> RemoteSigned</span><br></pre></td></tr></table></figure><p>进入目录后在终端输入<code>.\DG</code>，然后按下<kbd>Tab</kbd>键，会自动补全脚本名称，然后按下<kbd>Enter</kbd>键运行脚本。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\DG_Readiness_Tool_v3.<span class="number">6</span>.ps1 <span class="literal">-Disable</span></span><br></pre></td></tr></table></figure><p><img src="/images/windows_hyperv/%E8%BF%90%E8%A1%8C%E8%84%9A%E6%9C%AC.webp" class="lazyload" data-srcset="/images/windows_hyperv/%E8%BF%90%E8%A1%8C%E8%84%9A%E6%9C%AC.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="运行脚本"></p><h2 id="5-重启电脑"><a href="#5-重启电脑" class="headerlink" title="5. 重启电脑"></a>5. 重启电脑</h2><p>完成执行后关闭终端或 PowerShell，并保存所有打开的文件，重启电脑。<br>重启后Windows会进入Credential Guard Opt-out Tool，此时按下 <kbd>Win</kbd> 或 <kbd>F3</kbd> 后再按下回车即可继续。<br>![Credential Guard Opt-out Tool](&#x2F;images&#x2F;windows_hyperv&#x2F;Credential Guard Opt-out Tool.webp)</p><h2 id="6-查看-基于虚拟化安全性-状态"><a href="#6-查看-基于虚拟化安全性-状态" class="headerlink" title="6. 查看 基于虚拟化安全性 状态"></a>6. 查看 <code>基于虚拟化安全性</code> 状态</h2><p>完成上述操作后，电脑会再次重启，进入Windows后即可看到 Device&#x2F;Credential Guard 已关闭。<br>可通过Windows搜索栏输入“系统信息”进行查看。<br><img src="/images/windows_hyperv/Windows%E6%90%9C%E7%B4%A2%E6%A0%8F-%E7%B3%BB%E7%BB%9F%E4%BF%A1%E6%81%AF.webp" class="lazyload" data-srcset="/images/windows_hyperv/Windows%E6%90%9C%E7%B4%A2%E6%A0%8F-%E7%B3%BB%E7%BB%9F%E4%BF%A1%E6%81%AF.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Windows搜索栏-系统信息"><br><img src="/images/windows_hyperv/%E7%B3%BB%E7%BB%9F%E4%BF%A1%E6%81%AF.webp" class="lazyload" data-srcset="/images/windows_hyperv/%E7%B3%BB%E7%BB%9F%E4%BF%A1%E6%81%AF.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="系统信息"></p>]]>
      </content:encoded>
    </item>
    <item>
      <title>挂载多分区磁盘镜像</title>
      <link>https://315490.xyz/2025/01/02/linux/command/%E6%8C%82%E8%BD%BD%E5%A4%9A%E5%88%86%E5%8C%BA%E7%A3%81%E7%9B%98%E9%95%9C%E5%83%8F/</link>
      <description>
        <![CDATA[<h1 id="losetup-命令"><a href="#losetup-命令" class="headerlink" title="losetup 命令"></a>losetup 命令</h1><figure class="highlight bash"><table><tr]]>
      </description>
      <author>Qs315490</author>
      <category domain="https://315490.xyz/categories/linux/">linux</category>
      <category domain="https://315490.xyz/categories/linux/command/">command</category>
      <category domain="https://315490.xyz/tags/linux/">linux</category>
      <category domain="https://315490.xyz/tags/dd/">dd</category>
      <category domain="https://315490.xyz/tags/mount/">mount</category>
      <category domain="https://315490.xyz/tags/loop/">loop</category>
      <category domain="https://315490.xyz/tags/losetup/">losetup</category>
      <pubDate>Thu, 02 Jan 2025 05:50:56 GMT</pubDate>
      <content:encoded>
        <![CDATA[<h1 id="losetup-命令"><a href="#losetup-命令" class="headerlink" title="losetup 命令"></a>losetup 命令</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">losetup [options] [loopdev] [file]</span><br></pre></td></tr></table></figure><table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>-a –all</td><td>显示所有loop设备及其关联的文件</td></tr><tr><td>-d –detach &lt;loopdev&gt;</td><td>断开loop设备</td></tr><tr><td>-f –find</td><td>自动选择第一个未使用的loop设备</td></tr><tr><td>-j –associated &lt;file&gt;</td><td>显示给定文件关联的loop设备</td></tr><tr><td>-o –offset &lt;offset&gt;</td><td>指定偏移量</td></tr><tr><td>–sizelimit &lt;size&gt;</td><td>数据结束设置为数据开始，不超过&lt;size&gt;的字节</td></tr><tr><td>-r –read-only</td><td>挂载为只读</td></tr><tr><td>-p –partscan</td><td>强制内核扫描loop设备的分区表</td></tr><tr><td>–show</td><td>如果 <code>-f</code> 参数存在，则显示分配的loop设备名</td></tr><tr><td>–direct-io</td><td>使用直接I&#x2F;O访问loop设备, 绕过系统缓存</td></tr><tr><td>–sector-size &lt;4096&#x2F;512&gt;</td><td>设置扇区大小，默认为512字节</td></tr></tbody></table><h1 id="使用loop设备挂载多分区磁盘镜像"><a href="#使用loop设备挂载多分区磁盘镜像" class="headerlink" title="使用loop设备挂载多分区磁盘镜像"></a>使用loop设备挂载多分区磁盘镜像</h1><h2 id="挂载镜像为loop设备"><a href="#挂载镜像为loop设备" class="headerlink" title="挂载镜像为loop设备"></a>挂载镜像为loop设备</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">losetup /path/to/image</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">losetup  --partscan --find --show /path/to/image</span><br></pre></td></tr></table></figure><h2 id="挂载分区"><a href="#挂载分区" class="headerlink" title="挂载分区"></a>挂载分区</h2><p>正常挂载即可</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount /dev/loopXpY /mnt</span><br></pre></td></tr></table></figure><h2 id="卸载loop设备"><a href="#卸载loop设备" class="headerlink" title="卸载loop设备"></a>卸载loop设备</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">losetup -d /dev/loopX</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]>
      </content:encoded>
    </item>
    <item>
      <title>openwrt小技巧</title>
      <link>https://315490.xyz/2024/12/05/linux/openwrt/openwrt%E5%B0%8F%E6%8A%80%E5%B7%A7/</link>
      <description>
        <![CDATA[<h1 id="更新需升级的软件包"><a href="#更新需升级的软件包" class="headerlink" title="更新需升级的软件包"></a>更新需升级的软件包</h1><p>记录 OpenWrt&#x2F;LEDE 下更新所有待更新软件包的方法。</p>
<]]>
      </description>
      <author>Qs315490</author>
      <category domain="https://315490.xyz/categories/linux/">linux</category>
      <category domain="https://315490.xyz/categories/linux/openwrt/">openwrt</category>
      <category domain="https://315490.xyz/tags/openwrt/">openwrt</category>
      <category domain="https://315490.xyz/tags/opkg/">opkg</category>
      <pubDate>Thu, 05 Dec 2024 07:32:54 GMT</pubDate>
      <content:encoded>
        <![CDATA[<h1 id="更新需升级的软件包"><a href="#更新需升级的软件包" class="headerlink" title="更新需升级的软件包"></a>更新需升级的软件包</h1><p>记录 OpenWrt&#x2F;LEDE 下更新所有待更新软件包的方法。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">opkg update</span><br><span class="line">opkg list-upgradable | <span class="built_in">cut</span> -f 1 -d <span class="string">&#x27; &#x27;</span> | xargs opkg upgrade</span><br></pre></td></tr></table></figure>]]>
      </content:encoded>
    </item>
    <item>
      <title>修改开始菜单和任务栏默认设置</title>
      <link>https://315490.xyz/2024/03/21/windows/%E4%BF%AE%E6%94%B9%E5%BC%80%E5%A7%8B%E8%8F%9C%E5%8D%95%E5%92%8C%E4%BB%BB%E5%8A%A1%E6%A0%8F%E9%BB%98%E8%AE%A4%E8%AE%BE%E7%BD%AE/</link>
      <description>
        <![CDATA[<h1 id="修改开始菜单和任务栏默认设置"><a href="#修改开始菜单和任务栏默认设置" class="headerlink" title="修改开始菜单和任务栏默认设置"></a>修改开始菜单和任务栏默认设置</h1><p>Windows10 测试通过 </p>
<h]]>
      </description>
      <author>Qs315490</author>
      <category domain="https://315490.xyz/categories/Windows/">Windows</category>
      <category domain="https://315490.xyz/categories/Windows/%E5%B0%8F%E6%8A%80%E5%B7%A7/">小技巧</category>
      <category domain="https://315490.xyz/tags/Windows/">Windows</category>
      <category domain="https://315490.xyz/tags/%E8%87%AA%E5%AE%9A%E4%B9%89/">自定义</category>
      <pubDate>Thu, 21 Mar 2024 15:16:27 GMT</pubDate>
      <content:encoded>
        <![CDATA[<h1 id="修改开始菜单和任务栏默认设置"><a href="#修改开始菜单和任务栏默认设置" class="headerlink" title="修改开始菜单和任务栏默认设置"></a>修改开始菜单和任务栏默认设置</h1><p>Windows10 测试通过 </p><h2 id="开始菜单"><a href="#开始菜单" class="headerlink" title="开始菜单"></a>开始菜单</h2><table><thead><tr><th>属性</th><th>说明</th></tr></thead><tbody><tr><td>Size</td><td>确定磁贴的大小。</td></tr><tr><td>1x1</td><td>小磁贴</td></tr><tr><td>2x2</td><td>中等磁贴</td></tr><tr><td>4x2</td><td>宽磁贴</td></tr><tr><td>4x4</td><td>大磁贴</td></tr><tr><td>Row</td><td>指定磁贴显示在哪一行。</td></tr><tr><td>Column</td><td>指定磁贴显示在哪一列。</td></tr></tbody></table><h3 id="start-Tile"><a href="#start-Tile" class="headerlink" title="start:Tile"></a>start:Tile</h3><p>使用 AppUserModelID 指定以下任一项：</p><ul><li>通用 Windows 应用</li><li>Windows 8或Windows 8.1应用</li></ul><p>请注意，AppUserModelID 区分大小写。</p><h3 id="taskbar-DesktopApp"><a href="#taskbar-DesktopApp" class="headerlink" title="taskbar:DesktopApp"></a>taskbar:DesktopApp</h3><p>DesktopApplicationLinkPath - 指定桌面应用程序的快捷方式、可执行程序或.lnk文件的路径。</p><h2 id="start-DesktopApplicationTile"><a href="#start-DesktopApplicationTile" class="headerlink" title="start:DesktopApplicationTile"></a>start:DesktopApplicationTile</h2><p><code>未证实</code><br>用于指定以下任一项：</p><table><thead><tr><th>属性</th><th>说明</th></tr></thead><tbody><tr><td>DesktopApplicationID</td><td>Windows 桌面应用程序 AppUserModelID</td></tr><tr><td>DesktopApplicationLinkPath</td><td>已知文件夹中具有旧“开始菜单”文件夹中链接的应用程序 - 旧版“开始菜单”文件夹中的 Windows 桌面应用程序链接 - 旧版“开始菜单”文件夹中具有关联 .url 文件的 Web 链接磁贴</td></tr></tbody></table><h2 id="任务栏"><a href="#任务栏" class="headerlink" title="任务栏"></a>任务栏</h2><ul><li>使用 <code>&lt;taskbar:UWA&gt;</code> 和 AUMID 固定通用 Windows 平台应用</li><li>使用 <code>&lt;taskbar:DesktopApp&gt;</code> 和 桌面应用程序链接路径固定桌面应用程序</li></ul><h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><p>微软的文档实在看不懂，自己摸索出以下路径<br><code>C:\Users\Default\AppData\Local\Microsoft\Windows\shell\DefaultLayouts.xml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">FullDefaultLayoutTemplate</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns</span>=<span class="string">&quot;http://schemas.microsoft.com/Start/2014/FullDefaultLayout&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:start</span>=<span class="string">&quot;http://schemas.microsoft.com/Start/2014/StartLayout&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:taskbar</span>=<span class="string">&quot;http://schemas.microsoft.com/Start/2014/TaskbarLayout&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">Version</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">StartLayoutCollection</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">StartLayout</span> <span class="attr">GroupCellWidth</span>=<span class="string">&quot;6&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">start:Group</span> <span class="attr">LocalizedNameResourceTag</span>=<span class="string">&quot;TileGrid_DefaultGroup1&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">start:Tile</span> <span class="attr">Size</span>=<span class="string">&quot;2x2&quot;</span> <span class="attr">Column</span>=<span class="string">&quot;0&quot;</span> <span class="attr">Row</span>=<span class="string">&quot;0&quot;</span> <span class="attr">AppUserModelID</span>=<span class="string">&quot;Microsoft.WindowsStore_8wekyb3d8bbwe!App&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">start:Tile</span> <span class="attr">Size</span>=<span class="string">&quot;2x2&quot;</span> <span class="attr">Column</span>=<span class="string">&quot;2&quot;</span> <span class="attr">Row</span>=<span class="string">&quot;0&quot;</span> <span class="attr">AppUserModelID</span>=<span class="string">&quot;Microsoft.MicrosoftEdge_8wekyb3d8bbwe!MicrosoftEdge&quot;</span> /&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">start:Group</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">StartLayout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">StartLayoutCollection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TaskbarLayoutCollection</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">TaskbarLayout</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">taskbar:TaskbarPinList</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">taskbar:DesktopApp</span> <span class="attr">DesktopApplicationLinkPath</span>=<span class="string">&quot;%APPDATA%\Microsoft\Windows\Start Menu\Programs\System Tools\File Explorer.lnk&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">taskbar:UWA</span> <span class="attr">AppUserModelID</span>=<span class="string">&quot;Microsoft.MicrosoftEdge_8wekyb3d8bbwe!MicrosoftEdge&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">taskbar:TaskbarPinList</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">TaskbarLayout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">TaskbarLayoutCollection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">FullDefaultLayoutTemplate</span>&gt;</span></span><br></pre></td></tr></table></figure>]]>
      </content:encoded>
    </item>
    <item>
      <title>Windows共享打印机常见错误</title>
      <link>https://315490.xyz/2023/12/30/windows/Windows%E5%85%B1%E4%BA%AB%E6%89%93%E5%8D%B0%E6%9C%BA%E5%B8%B8%E8%A7%81%E9%94%99%E8%AF%AF/</link>
      <description>
        <![CDATA[<h1 id="0xa"><a href="#0xa" class="headerlink" title="0xa"></a>0xa</h1><p>未知，重试几次后问题解决。</p>
<h1 id="0x180b"><a href="#0x180b" class="headerl]]>
      </description>
      <author>Qs315490</author>
      <category domain="https://315490.xyz/categories/Windows/">Windows</category>
      <category domain="https://315490.xyz/categories/Windows/%E6%89%93%E5%8D%B0%E6%9C%BA/">打印机</category>
      <category domain="https://315490.xyz/tags/Windows/">Windows</category>
      <category domain="https://315490.xyz/tags/%E6%89%93%E5%8D%B0%E6%9C%BA/">打印机</category>
      <category domain="https://315490.xyz/tags/Windows%E5%85%B1%E4%BA%AB%E6%89%93%E5%8D%B0%E6%9C%BA/">Windows共享打印机</category>
      <pubDate>Sat, 30 Dec 2023 15:12:14 GMT</pubDate>
      <content:encoded>
        <![CDATA[<h1 id="0xa"><a href="#0xa" class="headerlink" title="0xa"></a>0xa</h1><p>未知，重试几次后问题解决。</p><h1 id="0x180b"><a href="#0x180b" class="headerlink" title="0x180b"></a>0x180b</h1><p>共享服务器版本过低<br>控制面板开启 <code>SMB1.0/CIFS</code> 重启解决</p><h1 id="0x11b-与-0x40"><a href="#0x11b-与-0x40" class="headerlink" title="0x11b 与 0x40"></a>0x11b 与 0x40</h1><p>新版本Windows出现此问题，原因KB5005565这个更新导致<br>使用注册表或卸载更新解决  </p><div class="tabs" id="tab-e-0x11b"><ul class="nav-tabs"><li class="tab active"><a class="#e-0x11b-1">注册表文件</a></li><li class="tab"><a class="#e-0x11b-2">cmd</a></li><li class="tab"><a class="#e-0x11b-3">PowerShell</a></li></ul><div class="tab-content"><div class="tab-pane active" id="e-0x11b-1"><div class="tag link"><a class="link-card" title="点击下载" href="/files/0x11b.reg"><div class="left"><img src="https://unpkg.com/volantis-static@0.0.1660614606622/media/org.volantis/logo/256/safari.png" class="lazyload" data-srcset="https://unpkg.com/volantis-static@0.0.1660614606622/media/org.volantis/logo/256/safari.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">点击下载</p><p class="url">/files/0x11b.reg</p></div></a></div><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Windows Registry Editor Version 5.00</span><br><span class="line">[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Print]</span><br><span class="line">&quot;RpcAuthnLevelPrivacyEnabled&quot;=dword:0</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="e-0x11b-2"><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg add &quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\<span class="built_in">Print</span>&quot; /v &quot;RpcAuthnLevelPrivacyEnabled&quot; /t dword /d <span class="number">0</span> /f</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="e-0x11b-3"><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set-ItemProperty</span> <span class="literal">-Path</span> <span class="string">&quot;HKLM:\SYSTEM\CurrentControlSet\Control\Print&quot;</span> <span class="literal">-Name</span> <span class="string">&quot;RpcAuthnLevelPrivacyEnabled&quot;</span> <span class="literal">-Value</span> <span class="number">0</span></span><br></pre></td></tr></table></figure></div></div></div>]]>
      </content:encoded>
    </item>
    <item>
      <title>Windows 小技巧</title>
      <link>https://315490.xyz/2023/12/30/windows/Windows%E5%B0%8F%E6%8A%80%E5%B7%A7/</link>
      <description>
        <![CDATA[<h1 id="知道IP查询内网设备的主机名"><a href="#知道IP查询内网设备的主机名" class="headerlink" title="知道IP查询内网设备的主机名"></a>知道IP查询内网设备的主机名</h1><figure class="highlight]]>
      </description>
      <author>Qs315490</author>
      <category domain="https://315490.xyz/categories/Windows/">Windows</category>
      <category domain="https://315490.xyz/categories/Windows/%E5%B0%8F%E6%8A%80%E5%B7%A7/">小技巧</category>
      <category domain="https://315490.xyz/tags/Windows/">Windows</category>
      <category domain="https://315490.xyz/tags/%E5%B0%8F%E6%8A%80%E5%B7%A7/">小技巧</category>
      <category domain="https://315490.xyz/tags/Windows-Server/">Windows Server</category>
      <category domain="https://315490.xyz/tags/%E5%AF%86%E7%A0%81%E5%AE%89%E5%85%A8%E8%AE%BE%E7%BD%AE/">密码安全设置</category>
      <category domain="https://315490.xyz/tags/DNS/">DNS</category>
      <category domain="https://315490.xyz/tags/IP/">IP</category>
      <category domain="https://315490.xyz/tags/%E4%B8%BB%E6%9C%BA%E5%90%8D/">主机名</category>
      <category domain="https://315490.xyz/tags/%E7%AB%AF%E5%8F%A3/">端口</category>
      <category domain="https://315490.xyz/tags/%E6%A1%8C%E9%9D%A2%E5%A3%81%E7%BA%B8/">桌面壁纸</category>
      <category domain="https://315490.xyz/tags/%E6%96%87%E4%BB%B6%E5%85%83%E6%95%B0%E6%8D%AE/">文件元数据</category>
      <category domain="https://315490.xyz/tags/Chrome/">Chrome</category>
      <category domain="https://315490.xyz/tags/Edge/">Edge</category>
      <pubDate>Sat, 30 Dec 2023 15:12:14 GMT</pubDate>
      <content:encoded>
        <![CDATA[<h1 id="知道IP查询内网设备的主机名"><a href="#知道IP查询内网设备的主机名" class="headerlink" title="知道IP查询内网设备的主机名"></a>知道IP查询内网设备的主机名</h1><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ping</span> -a &lt;IP地址&gt;</span><br></pre></td></tr></table></figure><h1 id="查询指定端口占用情况"><a href="#查询指定端口占用情况" class="headerlink" title="查询指定端口占用情况"></a>查询指定端口占用情况</h1><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">netstat -ano | <span class="built_in">findstr</span> &lt;端口号&gt;</span><br><span class="line">tasklist | <span class="built_in">findstr</span> &lt;返回的PID&gt;</span><br></pre></td></tr></table></figure><h1 id="当前用户桌面壁纸位置"><a href="#当前用户桌面壁纸位置" class="headerlink" title="当前用户桌面壁纸位置"></a>当前用户桌面壁纸位置</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%UserProfile%\AppData\Roaming\Microsoft\Windows\Themes\CachedFiles\</span><br></pre></td></tr></table></figure><h1 id="修改文件元数据"><a href="#修改文件元数据" class="headerlink" title="修改文件元数据"></a>修改文件元数据</h1><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建时间</span></span><br><span class="line">(<span class="built_in">ls</span> file.txt).CreationTime = <span class="string">&quot;2038-12-31 23:59:59&quot;</span></span><br><span class="line"><span class="comment"># 修改时间</span></span><br><span class="line">(<span class="built_in">ls</span> file.txt).LastWriteTime = <span class="string">&quot;2038-12-31 23:59:59&quot;</span></span><br><span class="line"><span class="comment"># 访问时间</span></span><br><span class="line">(<span class="built_in">ls</span> file.txt).LastAccessTime = <span class="string">&quot;2038-12-31 23:59:59&quot;</span></span><br></pre></td></tr></table></figure><h1 id="关闭-Chrome-系统升级提示"><a href="#关闭-Chrome-系统升级提示" class="headerlink" title="关闭 Chrome 系统升级提示"></a>关闭 Chrome 系统升级提示</h1><p>所有用户应用. 如果只需要当前用户生效，把 HKEY_LOCAL_MACHINE 替换为 HKEY_CURRENT_USER</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Windows Registry Editor Version 5.00 </span><br><span class="line"></span><br><span class="line">[HKEY_LOCAL_MACHINE\Software\Policies\Google\Chrome] </span><br><span class="line">&quot;SuppressUnsupportedOSWarning&quot;=dword:1</span><br><span class="line"></span><br><span class="line">[HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Edge] </span><br><span class="line">&quot;SuppressUnsupportedOSWarning&quot;=dword:1</span><br></pre></td></tr></table></figure><h1 id="关闭-Microsoft-Edge-使用推荐设置提示"><a href="#关闭-Microsoft-Edge-使用推荐设置提示" class="headerlink" title="关闭 Microsoft Edge 使用推荐设置提示"></a>关闭 Microsoft Edge 使用推荐设置提示</h1><p>所有用户应用. 如果只需要当前用户生效，把 HKEY_LOCAL_MACHINE 替换为 HKEY_CURRENT_USER</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Windows Registry Editor Version 5.00 </span><br><span class="line"></span><br><span class="line">[HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Edge] </span><br><span class="line">&quot;ShowRecommendationsEnabled&quot;=dword:0</span><br></pre></td></tr></table></figure><h1 id="MacOS-安装-Windows-卡准备就绪"><a href="#MacOS-安装-Windows-卡准备就绪" class="headerlink" title="MacOS 安装 Windows 卡准备就绪"></a>MacOS 安装 Windows 卡准备就绪</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Windows Registry Editor Version 5.00</span><br><span class="line"></span><br><span class="line">[HKLOCAL MACHINE\SYSTEM\SETUP\SATUS\ChildCompletion]</span><br><span class="line">&quot;setup.exe&quot; = dword:3</span><br></pre></td></tr></table></figure><h1 id="关闭-DNS-多解析"><a href="#关闭-DNS-多解析" class="headerlink" title="关闭 DNS 多解析"></a>关闭 DNS 多解析</h1><p>组策略<br>中文系统路径:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">计算机配置 -&gt; 管理模板 -&gt; 网络 -&gt; DNS 客户端 -&gt; 禁用智能多宿主名称解析</span><br></pre></td></tr></table></figure><p>英文系统路径:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Computer Configuration -&gt; Administrative Templates -&gt; Network -&gt; DNS Client -&gt; Turn Off Multicast Name Resolution</span><br></pre></td></tr></table></figure><h1 id="windows-Server取消密码复杂度"><a href="#windows-Server取消密码复杂度" class="headerlink" title="windows Server取消密码复杂度"></a>windows Server取消密码复杂度</h1><h2 id="1-打开本地安全策略"><a href="#1-打开本地安全策略" class="headerlink" title="1. 打开本地安全策略"></a>1. 打开本地安全策略</h2><p>服务管理工具 &gt; 工具 &gt; 本地安全策略</p><h2 id="2-密码策略"><a href="#2-密码策略" class="headerlink" title="2. 密码策略"></a>2. 密码策略</h2><p>账户策略 &gt; 密码策略 &gt; 密码必须符合复杂性要求 &gt; 禁用</p><p>其中，密码最长使用期限、密码最短使用期限、密码最短使用期限（分钟）可以设置为0，表示不限制</p><h1 id="解决Win11-24H2下网页卡屏-卡顿-显示残留的问题"><a href="#解决Win11-24H2下网页卡屏-卡顿-显示残留的问题" class="headerlink" title="解决Win11 24H2下网页卡屏&#x2F;卡顿&#x2F;显示残留的问题"></a>解决Win11 24H2下网页卡屏&#x2F;卡顿&#x2F;显示残留的问题</h1><p>如题，最近电脑老有问题，神烦<br>比如浏览网页，好端端的，随机的就会出现网页卡屏<br>我明明切换到另一个标签了，显示的还是上一个标签的图像<br>起初我以为是(显卡(因为vscode也有问题)，浏览器)的问题，后来发现其他网友在使用其他软件时也会遇到<br>那就是微软的锅了</p><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><h3 id="1-（推荐）禁用-MPO"><a href="#1-（推荐）禁用-MPO" class="headerlink" title="1. （推荐）禁用 MPO"></a>1. （推荐）禁用 <a href="https://learn.microsoft.com/zh-cn/windows-hardware/drivers/display/multiplane-overlay-support">MPO</a></h3><p>打开<code>注册表编辑器</code>，路径<code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\Dwm</code><br>新建一个<code>DWORD(32位)值</code>，命名为<code>OverlayTestMode</code>，值设为<code>5</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg add &quot;HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\Dwm&quot; /v OverlayTestMode /t REG_DWORD /d 5  </span><br></pre></td></tr></table></figure><h3 id="2-关闭硬件加速"><a href="#2-关闭硬件加速" class="headerlink" title="2. 关闭硬件加速"></a>2. 关闭硬件加速</h3><p>关了就没办法使用GPU硬件加速，导致看视频卡顿，CPU占用高，但是网页浏览正常</p><h3 id="3-退回23H2"><a href="#3-退回23H2" class="headerlink" title="3. 退回23H2"></a>3. 退回23H2</h3><h3 id="4-关闭浏览器设置"><a href="#4-关闭浏览器设置" class="headerlink" title="4. 关闭浏览器设置"></a>4. 关闭浏览器设置</h3><p>Edge浏览器的<code>GPU rasterization</code>和<code>Accelerated 2D canvas</code>都禁用了就好了，可以试试。<code>edge://flags/</code>进入设置。</p><h1 id="Windows-睡眠后，莫名唤醒"><a href="#Windows-睡眠后，莫名唤醒" class="headerlink" title="Windows 睡眠后，莫名唤醒"></a>Windows 睡眠后，莫名唤醒</h1><p>使用以下命令查看最后一次唤醒的原因</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powercfg /LASTWAKE</span><br></pre></td></tr></table></figure><h2 id="电源按钮唤醒"><a href="#电源按钮唤醒" class="headerlink" title="电源按钮唤醒"></a>电源按钮唤醒</h2><p>如果是有线连接，可能是局域网内其他设备的广播唤醒电脑。<br>在设备管理器里找到对应网卡，右键属性，取消勾选 <code>允许此设备唤醒计算机</code>。<br>如果需要 <code>网络唤醒(WoL)</code>功能，可以勾选 <code>允许此设备唤醒计算机</code>，然后勾选 <code>只允许幻术封包唤醒计算机</code>。</p><p>如果是无线网卡也可以试试。虽然无线网卡理论上没有这个功能，但是无线网卡也有唤醒能力。  </p><h1 id="Microsoft-Edge-浏览器历史记录、收藏夹、网页登录状态丢失bug"><a href="#Microsoft-Edge-浏览器历史记录、收藏夹、网页登录状态丢失bug" class="headerlink" title="Microsoft Edge 浏览器历史记录、收藏夹、网页登录状态丢失bug"></a>Microsoft Edge 浏览器历史记录、收藏夹、网页登录状态丢失bug</h1><p>该bug是由<code>edge游戏助手</code>引起，只需删掉游戏助手即可解决。</p><p>删除<code>edge游戏助手</code>的步骤：<kbd>Win</kbd>+<kbd>G</kbd>打开<code>xbox game bar</code>，点击最上面的<code>小组件菜单</code>→<code>小组件商店</code>→<code>已安装</code>，删除<code>edge游戏助手即可</code>。</p><p>由于<code>edge游戏助手</code>在系统更新时<code>会自动重新安装</code>，所以在更新系统后，需要再次<code>重复删除步骤</code>。</p><p>如果不幸触发了该bug，不用担心，你的所有记录都没有真正的丢失。在<code>删除edge游戏助手</code>，确保所有edge的进程关闭后，彻底地重启edge，<code>即可恢复所有的记录、收藏夹和网站的登录状态</code>。</p><h1 id="win7蓝屏A5解决方法-10代以上主板蓝屏A5"><a href="#win7蓝屏A5解决方法-10代以上主板蓝屏A5" class="headerlink" title="win7蓝屏A5解决方法 10代以上主板蓝屏A5"></a>win7蓝屏A5解决方法 10代以上主板蓝屏A5</h1><p>复制 <a href="/win7%E8%93%9D%E5%B1%8FA5%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E4%BF%AE%E6%94%B9%E6%96%87%E4%BB%B6acpi.zip">win7蓝屏A5问题解决修改文件acpi.zip</a> 到<code>C:\Windows\System32\drivers\</code>目录下，替换掉 <code>acpi.sys</code> 文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\System32\drivers\acpi.sys</span><br></pre></td></tr></table></figure>]]>
      </content:encoded>
    </item>
    <item>
      <title>Windows 快捷键</title>
      <link>https://315490.xyz/2023/08/25/windows/%E5%86%B7%E9%97%A8%E5%BF%AB%E6%8D%B7%E9%94%AE/</link>
      <description>
        <![CDATA[<h1 id="重启图形子系统"><a href="#重启图形子系统" class="headerlink" title="重启图形子系统"></a>重启图形子系统</h1><kbd>Win</kbd>+<kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>]]>
      </description>
      <author>Qs315490</author>
      <category domain="https://315490.xyz/categories/Windows/">Windows</category>
      <category domain="https://315490.xyz/categories/Windows/%E5%B0%8F%E6%8A%80%E5%B7%A7/">小技巧</category>
      <category domain="https://315490.xyz/tags/Windows/">Windows</category>
      <category domain="https://315490.xyz/tags/%E5%B0%8F%E6%8A%80%E5%B7%A7/">小技巧</category>
      <pubDate>Fri, 25 Aug 2023 07:40:00 GMT</pubDate>
      <content:encoded>
        <![CDATA[<h1 id="重启图形子系统"><a href="#重启图形子系统" class="headerlink" title="重启图形子系统"></a>重启图形子系统</h1><kbd>Win</kbd>+<kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>B</kbd><p>按下后会有嘟一声提示。</p>]]>
      </content:encoded>
    </item>
    <item>
      <title>btrfs raid1转read10记录</title>
      <link>https://315490.xyz/2023/05/31/linux/btrfs/btrfs-raid/</link>
      <description>
        <![CDATA[<h1 id="测试环境"><a href="#测试环境" class="headerlink" title="测试环境"></a>测试环境</h1><p>模拟我的4盘位硬盘盒，现有两块做 raid1 并且已经有数据。<br>在新加入两块盘后组成 raid10 并<font co]]>
      </description>
      <author>Qs315490</author>
      <category domain="https://315490.xyz/categories/linux/">linux</category>
      <category domain="https://315490.xyz/categories/linux/btrfs/">btrfs</category>
      <category domain="https://315490.xyz/tags/linux/">linux</category>
      <category domain="https://315490.xyz/tags/btrfs/">btrfs</category>
      <category domain="https://315490.xyz/tags/filesystem/">filesystem</category>
      <category domain="https://315490.xyz/tags/raid/">raid</category>
      <pubDate>Wed, 31 May 2023 01:45:49 GMT</pubDate>
      <content:encoded>
        <![CDATA[<h1 id="测试环境"><a href="#测试环境" class="headerlink" title="测试环境"></a>测试环境</h1><p>模拟我的4盘位硬盘盒，现有两块做 raid1 并且已经有数据。<br>在新加入两块盘后组成 raid10 并<font color="red">不损失数据</font>。<br>在 VMware Workstation 创建虚拟机配置如下<br><img src="/images/btrfs/vmware%E9%85%8D%E7%BD%AE.png" class="lazyload" data-srcset="/images/btrfs/vmware%E9%85%8D%E7%BD%AE.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="配置"></p><h1 id="创建Raid1阵列"><a href="#创建Raid1阵列" class="headerlink" title="创建Raid1阵列"></a>创建Raid1阵列</h1><p>模拟我现在的磁盘状态。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 已有数据需要 -f 参数强制覆盖</span></span><br><span class="line">mkfs.btrfs -m raid1 -d raid1 /dev/sd&#123;b,c&#125;</span><br></pre></td></tr></table></figure><p><img src="/images/btrfs/%E5%88%9B%E5%BB%BA%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F.png" class="lazyload" data-srcset="/images/btrfs/%E5%88%9B%E5%BB%BA%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="命令返回结果"><br>写入数据，用于辨别操作后是否损坏数据。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mount /dev/sdb /mnt</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;abcde&quot;</span>&gt;/mnt/test.txt</span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/random of=/mnt/testfile bs=1M count=256</span><br></pre></td></tr></table></figure><p>查看当前使用情况<br><img src="/images/btrfs/%E5%8A%A0%E5%85%A5%E8%AE%BE%E5%A4%87%E5%89%8D%E4%BD%BF%E7%94%A8%E6%83%85%E5%86%B5.png" class="lazyload" data-srcset="/images/btrfs/%E5%8A%A0%E5%85%A5%E8%AE%BE%E5%A4%87%E5%89%8D%E4%BD%BF%E7%94%A8%E6%83%85%E5%86%B5.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="加入设备前使用情况"></p><h1 id="将新加入磁盘加入阵列"><a href="#将新加入磁盘加入阵列" class="headerlink" title="将新加入磁盘加入阵列"></a>将新加入磁盘加入阵列</h1><h2 id="将磁盘加入阵列"><a href="#将磁盘加入阵列" class="headerlink" title="将磁盘加入阵列"></a>将磁盘加入阵列</h2><p>单纯的将磁盘加入阵列只是以reid1模式加入。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># btrfs device add -f device[ device ...] path -f参数强制覆盖会损失盘上所有数据</span></span><br><span class="line">btrfs d a /dev/sd&#123;d,e&#125; /mnt</span><br></pre></td></tr></table></figure><p><img src="/images/btrfs/%E5%8A%A0%E5%85%A5%E8%AE%BE%E5%A4%87%E5%90%8E%E4%BD%BF%E7%94%A8%E6%83%85%E5%86%B5.png" class="lazyload" data-srcset="/images/btrfs/%E5%8A%A0%E5%85%A5%E8%AE%BE%E5%A4%87%E5%90%8E%E4%BD%BF%E7%94%A8%E6%83%85%E5%86%B5.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="加入设备后使用情况"></p><h2 id="均衡磁盘"><a href="#均衡磁盘" class="headerlink" title="均衡磁盘"></a>均衡磁盘</h2><p>btrfs将设备加入阵列后数据是不会变动的。需要重新分配。<br>重新分配时加入转换参数将 reid1 转为 reid10.<br>经确认数据完整。不过实际设备往往数据量大需要时间长，在转换过程中突发断电数据难保。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">btrfs balance start -dconvert=raid10 -mconvert=raid10 -sconvert=raid10 -f /mnt</span><br></pre></td></tr></table></figure><p><img src="/images/btrfs/%E5%BC%80%E5%A7%8B%E5%B9%B3%E8%A1%A1%E6%95%B0%E6%8D%AE.png" class="lazyload" data-srcset="/images/btrfs/%E5%BC%80%E5%A7%8B%E5%B9%B3%E8%A1%A1%E6%95%B0%E6%8D%AE.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="开始平衡数据"><br><img src="/images/btrfs/%E5%B9%B3%E8%A1%A1%E6%95%B0%E6%8D%AE%E5%90%8E.png" class="lazyload" data-srcset="/images/btrfs/%E5%B9%B3%E8%A1%A1%E6%95%B0%E6%8D%AE%E5%90%8E.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="平衡数据后"><br><img src="/images/btrfs/%E5%B9%B3%E8%A1%A1%E6%95%B0%E6%8D%AE%E5%90%8E1.png" class="lazyload" data-srcset="/images/btrfs/%E5%B9%B3%E8%A1%A1%E6%95%B0%E6%8D%AE%E5%90%8E1.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="平衡数据后1"></p>]]>
      </content:encoded>
    </item>
    <item>
      <title>turtle</title>
      <link>https://315490.xyz/2023/02/27/Python/turtle/</link>
      <description>
        <![CDATA[<h1 id="备忘"><a href="#备忘" class="headerlink" title="备忘"></a>备忘</h1><p>默认画笔方向是右<br>先设置属性, 再调用命令</p>
<h1 id="画布"><a href="#画布" class="headerli]]>
      </description>
      <author>Qs315490</author>
      <category domain="https://315490.xyz/categories/Python/">Python</category>
      <category domain="https://315490.xyz/categories/Python/%E6%A8%A1%E5%9D%97/">模块</category>
      <category domain="https://315490.xyz/tags/Python/">Python</category>
      <category domain="https://315490.xyz/tags/%E6%A8%A1%E5%9D%97/">模块</category>
      <category domain="https://315490.xyz/tags/Turtle/">Turtle</category>
      <pubDate>Mon, 27 Feb 2023 04:36:25 GMT</pubDate>
      <content:encoded>
        <![CDATA[<h1 id="备忘"><a href="#备忘" class="headerlink" title="备忘"></a>备忘</h1><p>默认画笔方向是右<br>先设置属性, 再调用命令</p><h1 id="画布"><a href="#画布" class="headerlink" title="画布"></a>画布</h1><h2 id="screensize-x-y-color"><a href="#screensize-x-y-color" class="headerlink" title="screensize(x,y,color)"></a>screensize(x,y,color)</h2><p>设置画布大小和背景色(单词或16进制)<br>默认 <code>800*600</code> 白色</p><h2 id="setup-windowX-windowY-x-y"><a href="#setup-windowX-windowY-x-y" class="headerlink" title="setup(windowX,windowY,x,y)"></a>setup(windowX,windowY,x,y)</h2><p>设置画布大小和窗口起始位置的坐标<br>默认 <code>800*600</code> (0,0)</p><h1 id="移动"><a href="#移动" class="headerlink" title="移动"></a>移动</h1><h2 id="forward-x-fd-x"><a href="#forward-x-fd-x" class="headerlink" title="forward(x) fd(x)"></a>forward(x) fd(x)</h2><p>向当前画笔方向移动x个像素长度</p><h2 id="backward-x"><a href="#backward-x" class="headerlink" title="backward(x)"></a>backward(x)</h2><p>向当前画笔背面移动x像素长度</p><h2 id="pensize-px"><a href="#pensize-px" class="headerlink" title="pensize(px)"></a>pensize(px)</h2><p>设置画笔的宽度(像素单位)</p><h2 id="goto-x-y"><a href="#goto-x-y" class="headerlink" title="goto(x,y)"></a>goto(x,y)</h2><p>turtle(画笔)移动到坐标为 (x,y) 的位置</p><h2 id="right-x"><a href="#right-x" class="headerlink" title="right(x)"></a>right(x)</h2><p>顺时针旋转x度</p><h2 id="left-x"><a href="#left-x" class="headerlink" title="left(x)"></a>left(x)</h2><p>逆时针旋转x度</p><h2 id="pendown"><a href="#pendown" class="headerlink" title="pendown()"></a>pendown()</h2><p>落笔，移动时绘制图形</p><h2 id="penup"><a href="#penup" class="headerlink" title="penup()"></a>penup()</h2><p>抬笔，不绘制图形</p><h2 id="setx-a"><a href="#setx-a" class="headerlink" title="setx(a)"></a>setx(a)</h2><p>将当前x轴移动到a位置</p><h2 id="sety-a"><a href="#sety-a" class="headerlink" title="sety(a)"></a>sety(a)</h2><p>将当前y轴移动到a位置</p><h2 id="setheading-x"><a href="#setheading-x" class="headerlink" title="setheading(x)"></a>setheading(x)</h2><p>设置当前朝向为x角度</p><h2 id="speed-x"><a href="#speed-x" class="headerlink" title="speed(x)"></a>speed(x)</h2><p>设置当前速度为x, 默认为5</p><table><thead><tr><th>效果</th><th>x的值</th></tr></thead><tbody><tr><td>极快</td><td>0</td></tr><tr><td>快</td><td>10</td></tr><tr><td>正常</td><td>6</td></tr><tr><td>慢</td><td>3</td></tr><tr><td>极慢</td><td>1</td></tr></tbody></table><h2 id="shape-type"><a href="#shape-type" class="headerlink" title="shape(type)"></a>shape(type)</h2><p>更改光标外形, 默认箭头<br><code>turtle</code> 是海龟</p><h1 id="绘画"><a href="#绘画" class="headerlink" title="绘画"></a>绘画</h1><h2 id="dot-d-color"><a href="#dot-d-color" class="headerlink" title="dot(d,color)"></a>dot(d,color)</h2><p>绘制一个指定直径和颜色的圆点, 颜色是可选项</p><h2 id="circle-r-e-s"><a href="#circle-r-e-s" class="headerlink" title="circle(r,e,s)"></a>circle(r,e,s)</h2><p>r表示半径，正值逆时针旋转，负值顺时针旋转<br>e表示度数，绘制曲线<br>s表示边数，可用于绘制正多边形  </p><p class='p yellow'>r是必要的; e和s参数可有可无</p><h2 id="pencolor"><a href="#pencolor" class="headerlink" title="pencolor()"></a>pencolor()</h2><p>设置画笔颜色</p><h2 id="fillcolor-color"><a href="#fillcolor-color" class="headerlink" title="fillcolor(color)"></a>fillcolor(color)</h2><p>画出图形的内部填充颜色</p><h2 id="color-1-2"><a href="#color-1-2" class="headerlink" title="color(1, 2)"></a>color(1, 2)</h2><p>同时设置pencolor&#x3D;1, fillcolor&#x3D;2(内部的填充颜色)</p><h2 id="filling"><a href="#filling" class="headerlink" title="filling()"></a>filling()</h2><p>返回当前是否在填充状态</p><h2 id="begin-fill"><a href="#begin-fill" class="headerlink" title="begin_fill()"></a>begin_fill()</h2><p>准备填充图形</p><h2 id="end-fill"><a href="#end-fill" class="headerlink" title="end_fill()"></a>end_fill()</h2><p>填充结束(完成)</p><h2 id="hideturtle"><a href="#hideturtle" class="headerlink" title="hideturtle()"></a>hideturtle()</h2><p>隐藏画笔的turtle形状</p><h2 id="showturtle"><a href="#showturtle" class="headerlink" title="showturtle()"></a>showturtle()</h2><p>显示画笔的turtle形状</p><h2 id="clear"><a href="#clear" class="headerlink" title="clear()"></a>clear()</h2><p>清空窗口(turtle的位置和状态不会改变)</p><h2 id="reset"><a href="#reset" class="headerlink" title="reset()"></a>reset()</h2><p>清空窗口，(重置turtle状态为起始状态)</p><h2 id="undo"><a href="#undo" class="headerlink" title="undo()"></a>undo()</h2><p>撤销上一个动作</p><h2 id="isvisible"><a href="#isvisible" class="headerlink" title="isvisible()"></a>isvisible()</h2><p>返回当前turtle是否可见</p><h2 id="stamp"><a href="#stamp" class="headerlink" title="stamp()"></a>stamp()</h2><p>复制当前图形</p><h2 id="done"><a href="#done" class="headerlink" title="done()"></a>done()</h2><p>turtle中的最后一个语句</p><h2 id="write-x-font-“name”-size-”type”"><a href="#write-x-font-“name”-size-”type”" class="headerlink" title="write(x [,font&#x3D;(“name”,size,”type”)])"></a>write(x [,font&#x3D;(“name”,size,”type”)])</h2><p>写出文本，x为文本内容，字体名称是name，大小是size，类型是type(在线执行无法执行英文或汉字属于正常现象)</p>]]>
      </content:encoded>
    </item>
    <item>
      <title>wireguard代理</title>
      <link>https://315490.xyz/2022/12/29/linux/openwrt/wireguard%E4%BB%A3%E7%90%86/</link>
      <description>
        <![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>本教程只是实验目的，禁止用于非法用途。一切后果与本人无关。</p>
<h1 id="测试环境"><a href="#测试环境" class=]]>
      </description>
      <author>Qs315490</author>
      <category domain="https://315490.xyz/categories/linux/">linux</category>
      <category domain="https://315490.xyz/categories/linux/openwrt/">openwrt</category>
      <category domain="https://315490.xyz/tags/linux/">linux</category>
      <category domain="https://315490.xyz/tags/openwrt/">openwrt</category>
      <category domain="https://315490.xyz/tags/wireguard/">wireguard</category>
      <category domain="https://315490.xyz/tags/proxy/">proxy</category>
      <category domain="https://315490.xyz/tags/nat/">nat</category>
      <category domain="https://315490.xyz/tags/route/">route</category>
      <pubDate>Thu, 29 Dec 2022 13:16:55 GMT</pubDate>
      <content:encoded>
        <![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>本教程只是实验目的，禁止用于非法用途。一切后果与本人无关。</p><h1 id="测试环境"><a href="#测试环境" class="headerlink" title="测试环境"></a>测试环境</h1><p><img src="/images/WireGuard%E4%BB%A3%E7%90%86.png" class="lazyload" data-srcset="/images/WireGuard%E4%BB%A3%E7%90%86.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="WireGuard代理"></p><h1 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h1><p>在原有WireGuard隧道的基础上进行小修改即可。 </p><h2 id="路由器"><a href="#路由器" class="headerlink" title="路由器"></a>路由器</h2><h3 id="防火墙"><a href="#防火墙" class="headerlink" title="防火墙"></a>防火墙</h3><p>在WireGuard的防火墙空间上 <code>允许转发到wan所在的空间</code> 既可。<br>入站、出站、转发建议全部接受。开启<code>IP动态伪装(这个是IPv4的NAT，v6NAT需要改防火墙文件且只有fw4版本才开始支持)</code>。<br>添加防火墙规则(负责转发IPv6，一般来说V4 wan口默认全局NAT)。其他Linux命令差不多，要操作的表不一样。</p><div class="tabs" id="tab-firewall"><ul class="nav-tabs"><li class="tab active"><a class="#firewall-1">iptables(22.03之前)</a></li><li class="tab"><a class="#firewall-2">nftables(22.03之后)</a></li></ul><div class="tab-content"><div class="tab-pane active" id="firewall-1"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">OpenWrt21.02.5测试没有问题</span><br><span class="line"><span class="comment"># 命令     nat表     wan出站对应的链       匹配： 限制源地址 跳到MASQUERADE(自动重写地址为出站端口)</span></span><br><span class="line">ip6tables -t nat -A zone_wan_postrouting -s 10.3.3.0/24 -j MASQUERADE</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="firewall-2"><p>在luci界面添加规则，或者在命令行添加规则。命令行规则自行设置持久化。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># OpenWrt22.03.2测试没有问题</span></span><br><span class="line"><span class="comment"># 添加规则 在inet集fw4表的srcnat_wan链中，匹配是IPv6且iif(源网卡)是wg网卡的数据做masquerade(自动重写地址为出站端口)</span></span><br><span class="line">nft add rule inet fw4 srcnat_wan meta nfproto ipv6 iif <span class="string">&quot;wg&quot;</span> masquerade</span><br></pre></td></tr></table></figure></div></div></div><h3 id="路由表"><a href="#路由表" class="headerlink" title="路由表"></a>路由表</h3><p>如果到这里设置外围设备允许的IP地址为 <code>0.0.0.0/0,::/0</code> 或 <code>::/1, 8000::/1, 0.0.0.0/1, 128.0.0.0/1</code> IPv6能上网就不需要继续看了，教程结束。<br>如果IPv6不能联网大概率是路由表的锅。<br>IPv4的路由表是自动配置的。IPv6的路由表自动配置的可能会有问题。<br>使用以下方法解决</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF &gt; /etc/hotput.d/iface/99-wireguard</span></span><br><span class="line"><span class="string">#!/bin/sh</span></span><br><span class="line"><span class="string">[ $ACTION = ifup ]||exit0</span></span><br><span class="line"><span class="string"># 要检测上线的接口(一般是wan)</span></span><br><span class="line"><span class="string">iface=&#x27;pppor-wan&#x27;</span></span><br><span class="line"><span class="string">[ $INTERFACE = &quot;$iface&quot; ]||exit 0</span></span><br><span class="line"><span class="string">logger -t WireGuard &quot;接口$iface重新上线，正在重新分配路由&quot;</span></span><br><span class="line"><span class="string">route=$(ip -6 route show dev $iface|head -n1|awk &#x27;&#123;print $1,$4,$5,$6,$7&#125;&#x27;)</span></span><br><span class="line"><span class="string">status=$(ip -6 add route $route)</span></span><br><span class="line"><span class="string">logger -t WireGuard &quot;IPv6路由状态：$route $status&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="built_in">chmod</span> +x /etc/hotplug.d/iface/99-wireguard</span><br><span class="line">route=$(ip -6 route show dev <span class="variable">$iface</span>|<span class="built_in">head</span> -n1|awk <span class="string">&#x27;&#123;print $1,$4,$5,$6,$7&#125;&#x27;</span>)</span><br><span class="line">ip -6 add route <span class="variable">$route</span></span><br></pre></td></tr></table></figure><p>现在IPv6应该可以正常上网了。</p>]]>
      </content:encoded>
    </item>
    <item>
      <title>WireGuard同网段建立隧道</title>
      <link>https://315490.xyz/2022/12/29/linux/openwrt/wireguard%E5%90%8C%E7%BD%91%E6%AE%B5%E7%A9%BF%E9%80%8F/</link>
      <description>
        <![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>这才是 <code>VPN(虚拟局域网)</code> 的正确用途。<br>先根据网上的方法创建一个隧道。<br>此为同网段NAT-to-N]]>
      </description>
      <author>Qs315490</author>
      <category domain="https://315490.xyz/categories/linux/">linux</category>
      <category domain="https://315490.xyz/categories/linux/openwrt/">openwrt</category>
      <category domain="https://315490.xyz/tags/linux/">linux</category>
      <category domain="https://315490.xyz/tags/openwrt/">openwrt</category>
      <category domain="https://315490.xyz/tags/wireguard/">wireguard</category>
      <category domain="https://315490.xyz/tags/nat-to-nat/">nat-to-nat</category>
      <pubDate>Thu, 29 Dec 2022 12:29:09 GMT</pubDate>
      <content:encoded>
        <![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>这才是 <code>VPN(虚拟局域网)</code> 的正确用途。<br>先根据网上的方法创建一个隧道。<br>此为同网段NAT-to-NAT<br>不同网段可以参考网上方案，或者忽略本方案的DHCP修改。<br>此方案基于OpenWrt，其他Linux版本需要将配置写在WireGuard的配置文件里(网卡的上下线事件)。</p><h1 id="测试环境"><a href="#测试环境" class="headerlink" title="测试环境"></a>测试环境</h1><p>路由器1：有公网IP地址，做服务器<br>路由器2：无公网地址，服务器建设在此设备的网络下<br>需要把对路由器1的访问转发到路由器2对应的设备上<br><img src="/images/WireGuard%E5%90%8C%E7%BD%91%E6%AE%B5%E7%BB%84%E7%BD%91.png" class="lazyload" data-srcset="/images/WireGuard%E5%90%8C%E7%BD%91%E6%AE%B5%E7%BB%84%E7%BD%91.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="WireGuard同网段组网"></p><h1 id="实验步骤"><a href="#实验步骤" class="headerlink" title="实验步骤"></a>实验步骤</h1><p>在此步应该已经建立起一个可以通过WireGuard互相访问的隧道</p><h2 id="路由器1配置"><a href="#路由器1配置" class="headerlink" title="路由器1配置"></a>路由器1配置</h2><h3 id="WireGuard虚拟网卡"><a href="#WireGuard虚拟网卡" class="headerlink" title="WireGuard虚拟网卡"></a>WireGuard虚拟网卡</h3><p>需要配置对端设备允许的IP地址，因为我需要访问一个IP段所以添加了 <code>192.168.0.192/26</code></p><h3 id="防火墙"><a href="#防火墙" class="headerlink" title="防火墙"></a>防火墙</h3><p>WireGuard虚拟网卡建议单独放一个防火墙<br>名称随意<br>开启<code>IP动态伪装(NAT)</code>, 允许转发到lan，允许来自lan转发。入站、出站、转发建议全部接受。</p><h3 id="DHCP"><a href="#DHCP" class="headerlink" title="DHCP"></a>DHCP</h3><p>因为两个网段的IP是一样的为了保证 <code>一个IP对应一个设备</code>，需要对DHCP做限制。<br>保留一些地址给路由器下的设备使用。<br>可以使用子网掩码分割地址<br>本次实验我通过控制DHCP的允许的客户端数量保留 <code>192.168.0.192/26</code> 范围的地址供 <code>路由器2</code> 的设备使用。</p><h3 id="静态路由"><a href="#静态路由" class="headerlink" title="静态路由"></a>静态路由</h3><p>这个步骤尤为关键, 因为我没有直接修改子网掩码，这一步做网络路由。告诉路由器192.168.0.192&#x2F;26内的IP地址在别处。<br>如果是直接修改子网掩码的可以忽略这一步。因为对路由器来说那段地址已经不是它管的了，自然会去其他地方寻找。<br>根据上面步骤保留的IP地址配置<br>新建静态路由。</p><table><thead><tr><th>名称</th><th>内容</th></tr></thead><tbody><tr><td>接口</td><td>WireGuard的虚拟网卡</td></tr><tr><td>目标</td><td>上面保留的地址，使用CIDR写法列如：IP段192.168.0.192&#x2F;26或单个地址192.168.0.254&#x2F;32</td></tr><tr><td>网关</td><td>下一跳地址，此处我填10.3.3.2(目标网段路由地址)</td></tr></tbody></table><h2 id="路由器2配置"><a href="#路由器2配置" class="headerlink" title="路由器2配置"></a>路由器2配置</h2><h3 id="防火墙-1"><a href="#防火墙-1" class="headerlink" title="防火墙"></a>防火墙</h3><p>同路由器1配置<br>WireGuard虚拟网卡建议单独放一个防火墙<br>名称随意<br>开启<code>IP动态伪装(NAT)</code>, 允许转发到lan，允许来自lan转发。入站、出站、转发建议全部接受。<br>因为路由器1已经开了NAT转换，所以对于路由器2来说是10.3.3.1访问了它。又因为10.3.3.1符合10.3.3.0&#x2F;24网段，所以可以接受数据包，再经过NAT后访问目的地址。<br>目的设备也只能知道是10.3.3.1访问了它，这是这个方案的缺陷。</p><h2 id="端口映射"><a href="#端口映射" class="headerlink" title="端口映射"></a>端口映射</h2><p>现在可以在 <code>路由器1</code> 上 <code>直接映射</code> 路由器2对应 <code>192.168.0.192/26 范围</code>内设备的端口，就像这个设备本来就在路由器1上一样(跟内网差不多)。<br>做到这一步，在路由器1上ping路由器2(10.3.3.2)和路由器2上的对应网段的设备(192.168.0.254)应该是可以直接ping通的。</p>]]>
      </content:encoded>
    </item>
    <item>
      <title>MySQL小知识</title>
      <link>https://315490.xyz/2022/08/31/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL%E5%B0%8F%E7%9F%A5%E8%AF%86/</link>
      <description>
        <![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p><code>SHOW TABLES FROM database</code> 与以下条目等价</p>
<figure class="high]]>
      </description>
      <author>Qs315490</author>
      <category domain="https://315490.xyz/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</category>
      <category domain="https://315490.xyz/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/">mysql</category>
      <category domain="https://315490.xyz/tags/mysql/">mysql</category>
      <pubDate>Wed, 31 Aug 2022 04:25:01 GMT</pubDate>
      <content:encoded>
        <![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p><code>SHOW TABLES FROM database</code> 与以下条目等价</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">use database;</span><br><span class="line"><span class="keyword">SHOW</span> TABLES;</span><br></pre></td></tr></table></figure><h1 id="表层结构"><a href="#表层结构" class="headerlink" title="表层结构"></a>表层结构</h1><h2 id="information-schema"><a href="#information-schema" class="headerlink" title="information_schema"></a>information_schema</h2><table><thead><tr><th>表</th><th>注解</th></tr></thead><tbody><tr><td>SCHEMATA</td><td><code>SHOW DATABASES</code> 命令的结果取自此表，数据库信息在这此储</td></tr><tr><td>TABLES</td><td><code>SHOW TABLES</code> 命令结果取自此表，表格信息在此存储</td></tr><tr><td>COLUMNS</td><td><code>SHOW COLUMNS</code> 命令结果取自此表，表列信息在此存储</td></tr><tr><td>STATISTICS</td><td><code>SHOW INDEX</code> 命令结果取自此表, 索引信息在此存储</td></tr></tbody></table><h1 id="等效命令"><a href="#等效命令" class="headerlink" title="等效命令"></a>等效命令</h1><h2 id="show-databases"><a href="#show-databases" class="headerlink" title="show databases"></a>show databases</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> SCHEMA_NAME <span class="keyword">FROM</span> information_schema.SCHEMATA;</span><br></pre></td></tr></table></figure><h2 id="show-tables-FROM-database"><a href="#show-tables-FROM-database" class="headerlink" title="show tables FROM database"></a>show tables FROM database</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> TABLE_NAME <span class="keyword">FROM</span> information_schema.TABLES <span class="keyword">where</span> TABLE_SCHEMA <span class="operator">=</span> <span class="string">&#x27;database&#x27;</span>;</span><br></pre></td></tr></table></figure><h2 id="show-columns-FROM-database-table"><a href="#show-columns-FROM-database-table" class="headerlink" title="show columns FROM database.table"></a>show columns FROM database.table</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> COLUMN_NAME <span class="keyword">FROM</span> information_schema.COLMNS <span class="keyword">where</span> TABLE_SCHEMA <span class="operator">=</span> <span class="string">&#x27;database&#x27;</span> <span class="keyword">AND</span> TABLE_NAME <span class="operator">=</span> <span class="string">&#x27;table&#x27;</span>; </span><br></pre></td></tr></table></figure><h1 id="环境信息获取"><a href="#环境信息获取" class="headerlink" title="环境信息获取"></a>环境信息获取</h1><h2 id="数据库数据位置"><a href="#数据库数据位置" class="headerlink" title="数据库数据位置"></a>数据库数据位置</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@datadir</span>;</span><br></pre></td></tr></table></figure><h2 id="数据库安装位置"><a href="#数据库安装位置" class="headerlink" title="数据库安装位置"></a>数据库安装位置</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@basedir</span>;</span><br></pre></td></tr></table></figure><h2 id="系统类别"><a href="#系统类别" class="headerlink" title="系统类别"></a>系统类别</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@VERSION_COMPILE_OS</span>;</span><br></pre></td></tr></table></figure><h2 id="MySQL版本"><a href="#MySQL版本" class="headerlink" title="MySQL版本"></a>MySQL版本</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> VERSION();</span><br></pre></td></tr></table></figure><h2 id="可执行注释"><a href="#可执行注释" class="headerlink" title="可执行注释"></a>可执行注释</h2><p class='p red'>注意: 5位数字是低于或等于当前版本才会运行后面的命令</p><p>&#x2F;*!(数据库版本5位数字)(要执行的命令)*&#x2F;<br>列如数据库版本5.8.17</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*!50817SELECT VERSION();*/</span></span><br></pre></td></tr></table></figure><p>任何版本都要执行</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*!00000SELECT VERSION();*/</span></span><br></pre></td></tr></table></figure><h2 id="当前连接数据库的人数"><a href="#当前连接数据库的人数" class="headerlink" title="当前连接数据库的人数"></a>当前连接数据库的人数</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> CONNECTION_ID();</span><br></pre></td></tr></table></figure><h2 id="当前用户信息"><a href="#当前用户信息" class="headerlink" title="当前用户信息"></a>当前用户信息</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> PROCESSLIST;</span><br></pre></td></tr></table></figure>]]>
      </content:encoded>
    </item>
    <item>
      <title>openwrt防火墙只允许国内访问</title>
      <link>https://315490.xyz/2022/07/29/linux/openwrt/openwrt_firewall_allow_cn/</link>
      <description>
        <![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>由于我家是电信公网，在后台日志中常常看到来自世界各地的访问。<br>这些IP尝试爆破我SSH服务的密码、微软远程桌面的用户名和密码，显然是一]]>
      </description>
      <author>Qs315490</author>
      <category domain="https://315490.xyz/categories/linux/">linux</category>
      <category domain="https://315490.xyz/categories/linux/openwrt/">openwrt</category>
      <category domain="https://315490.xyz/tags/openwrt/">openwrt</category>
      <category domain="https://315490.xyz/tags/firewall/">firewall</category>
      <category domain="https://315490.xyz/tags/iptables/">iptables</category>
      <category domain="https://315490.xyz/tags/nftables/">nftables</category>
      <pubDate>Fri, 29 Jul 2022 03:47:09 GMT</pubDate>
      <content:encoded>
        <![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>由于我家是电信公网，在后台日志中常常看到来自世界各地的访问。<br>这些IP尝试爆破我SSH服务的密码、微软远程桌面的用户名和密码，显然是一个安全隐患。<br>为了使我的防火墙更加安全，我决定将其设置为只允许国内访问。</p><div class="note info"><p>openwrt 22.03 版开始使用 nftables，不再使用 iptables。<br> openwrt 22.03.3 版本 Luci 界面支持配置 IP集</p></div><h1 id="安装所需的依赖包"><a href="#安装所需的依赖包" class="headerlink" title="安装所需的依赖包"></a>安装所需的依赖包</h1><div class="note info"><p>安装 <code>ipset</code>, openwrt 22.03 或更新版本需要安装 <code>iptables-nft</code> 来兼容iptables命令。<br> PS: <code>nftables</code> 自带列表功能，不需要 <code>ipsec</code>。</p></div><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">opkg update</span><br><span class="line">opkg install ipset</span><br></pre></td></tr></table></figure><h1 id="配置-IP-列表"><a href="#配置-IP-列表" class="headerlink" title="配置 IP 列表"></a>配置 IP 列表</h1><div class="tabs" id="tab-ipset"><ul class="nav-tabs"><li class="tab active"><a class="#ipset-1">ipset</a></li><li class="tab"><a class="#ipset-2">nftables</a></li><li class="tab"><a class="#ipset-3">Luci</a></li></ul><div class="tab-content"><div class="tab-pane active" id="ipset-1"><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建一个名为cnip的规则</span></span><br><span class="line">ipset create cnip <span class="built_in">hash</span>:net</span><br><span class="line"><span class="comment"># 下载国家IP段，这里以中国为例</span></span><br><span class="line">wget -P /tmp/ http://www.ipdeny.com/ipblocks/data/countries/cn.zone</span><br><span class="line"><span class="comment"># 将IP段添加到cnip规则中</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(<span class="built_in">cat</span> /tmp/cn.zone ); <span class="keyword">do</span> ipset add cnip <span class="variable">$i</span>; <span class="keyword">done</span></span><br><span class="line"><span class="comment"># 保存规则到配置文件中</span></span><br><span class="line">ipset save &gt; /etc/ipset.conf</span><br><span class="line"><span class="comment"># 重启自动恢复ipset规则</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ipset -R &lt; /etc/ipset.conf&quot;</span> &gt; /etc/rc.local</span><br></pre></td></tr></table></figure><div class="note warning"><p>注意：最后有一条命令会覆盖这个文件的内容，或者手动插入 <code>ipset -R &lt; /etc/ipset.conf</code> 到 <code>exit 0</code> 命令前一行</p></div></div><div class="tab-pane" id="ipset-2"><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建一个名为cnip的规则</span></span><br><span class="line">nft add <span class="built_in">set</span> inet fw4 CNIP&#123;<span class="built_in">type</span> ipv4_addr\; flags interval\;&#125;</span><br><span class="line"><span class="comment"># 下载国家IP段，这里以中国为例</span></span><br><span class="line">wget -P /tmp/ http://www.ipdeny.com/ipblocks/data/countries/cn.zone</span><br><span class="line"><span class="comment"># 将IP段添加到cnip规则中  注：有效率问题</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(<span class="built_in">cat</span> /tmp/cn.zone ); <span class="keyword">do</span> nft add element inet fw4 CNIP &#123;<span class="variable">$i</span>&#125;; <span class="keyword">done</span></span><br><span class="line"><span class="comment"># 保存规则到配置文件中</span></span><br><span class="line">nft list <span class="built_in">set</span> inet fw4 CNIP &gt; /etc/CNIP.nft</span><br><span class="line"><span class="comment"># 重启自动恢复规则, firewall.user 文件可能不存在，反正能在防火墙运行时添加规则就行。</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;nft -f /etc/CNIP.nft&quot;</span> &gt;&gt; /etc/firewall.user</span><br></pre></td></tr></table></figure><p>新安装的系统需要手动配置 <code>firewall.user</code>。参考以下链接或代码块。</p><div class="tag link"><a class="link-card" title="" href="firewall配置文件说明"><div class="left"><img src="https://openwrt.org/docs/guide-user/firewall/firewall_configuration#includes_for_2203_and_later_with_fw4" class="lazyload" data-srcset="https://openwrt.org/docs/guide-user/firewall/firewall_configuration#includes_for_2203_and_later_with_fw4" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text"></p><p class="url">firewall配置文件说明</p></div></a></div><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">config include</span><br><span class="line">    option path &#x27;/etc/firewall.user&#x27;</span><br><span class="line">    option fw4_compatible 1</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="ipset-3"><p>自行准备一个<code>cn.zone</code>文件，内容为国家IP段。</p><ol><li>打开<code>网络</code>-&gt;<code>防火墙</code>-&gt;<code>IP集合</code></li><li>点击<code>添加</code></li><li><code>数据包字段匹配</code>选择<code>IP地址</code></li><li>通过<code>包括文件</code>上传<code>cn.zone</code>文件，点击<code>保存</code></li><li>点击<code>保存&amp;应用</code></li></ol></div></div></div><h1 id="配置防火墙"><a href="#配置防火墙" class="headerlink" title="配置防火墙"></a>配置防火墙</h1><div class="tabs" id="tab-firewall"><ul class="nav-tabs"><li class="tab active"><a class="#firewall-1">iptables</a></li><li class="tab"><a class="#firewall-2">nftables</a></li><li class="tab"><a class="#firewall-3">Luci</a></li></ul><div class="tab-content"><div class="tab-pane active" id="firewall-1"><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将规则写入防火墙的自定义规则文件中</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt;&gt; /etc/firewall.user</span></span><br><span class="line"><span class="string"># 阻断端口22 3389</span></span><br><span class="line"><span class="string">iptables -I zone_wan_input -p tcp -m multiport  --dport 22,3389 -j DROP</span></span><br><span class="line"><span class="string"># 允许国内访问端口</span></span><br><span class="line"><span class="string">iptables -I zone_wan_input -p tcp -m multiport  --dport 22,3389 -m set --match-set cnip src -j ACCEPT</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="comment"># 重启防火墙, 报错就用service firewall restart</span></span><br><span class="line">fw3 restart</span><br></pre></td></tr></table></figure><div class="note info"><p>openwrt的防火墙<code>Filter</code>表中<code>INPUT</code>链处理所有接入的包, 其中<code>zone_wan_input</code>链是<code>wan</code>空间的<code>INPUT</code>链。<br> <code>zone_wan_input</code>链中可能有规则会允许所有的包通过，为保证规则的效应<code>iptables</code>使用<code>插入(-I)</code>而不是<code>添加(-A)</code>。</p></div></div><div class="tab-pane" id="firewall-2"><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># firewall.user文件可能不存在，反正能在防火墙运行时添加规则就行</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF &gt;&gt; /etc/firewall.user</span></span><br><span class="line"><span class="string"># 创建一个由端口组成的列表</span></span><br><span class="line"><span class="string">nft add set inet fw4 PORT&#123;type inet_service\; flags interval\;&#125;</span></span><br><span class="line"><span class="string"># 向列表添加端口</span></span><br><span class="line"><span class="string">nft add element inet fw4 PORT&#123;ssh,3389&#125;</span></span><br><span class="line"><span class="string"># 阻止列表外的IP访问端口</span></span><br><span class="line"><span class="string">nft insert rule inet fw4 input_wan ip saddr != @CNIP tcp dport @PORT drop</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="comment"># 重启防火墙, 报错就用service firewall restart</span></span><br><span class="line">fw4 restart</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="firewall-3"><ol><li>打开<code>网络</code>-&gt;<code>防火墙</code>-&gt;<code>通信规则</code></li><li>点击<code>添加</code>，源区域<code>wan</code>，目的区域<code>输入</code>，把要限制的端口添加到<code>目的端口</code>中，操作<code>丢弃</code>，点击<code>保存</code></li><li>点击<code>添加</code>，源区域<code>wan</code>，目的区域<code>输入</code>，限制的端口添加到<code>目的端口</code>中，操作<code>接受</code>，高级设置里<code>使用IP集</code>选择之前创建的IP集，点击<code>保存</code></li></ol></div></div></div>]]>
      </content:encoded>
    </item>
  </channel>
</rss>
